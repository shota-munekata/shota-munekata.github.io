<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#007bff">
    <title>Regional Report</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles_manual.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <img src="logo.png" alt="Regional Report" class="logo-image">
                <div class="region-display">
                    <span id="regionDisplay">å…¨å›½ç‰ˆ</span>
                </div>
            </div>
            
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’æ¤œç´¢...">
                <button class="search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>

            <!-- å¤©æ°—äºˆå ±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="weather-forecast-header" id="weatherForecastHeader">
                <div class="weather-location" id="weatherLocation">æ±äº¬ã®å¤©æ°—</div>
                <div class="weather-forecast-scroll">
                    <!-- å¤©æ°—äºˆå ±ãŒJavaScriptã§å‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                </div>
            </div>

            <div class="header-controls">
                <div class="location-selector">
                    <i class="fas fa-location-dot"></i>
                    <select id="regionSelect">
                        <option value="all">å…¨å›½</option>
                        <option value="hokkaido">åŒ—æµ·é“</option>
                        <option value="tohoku">æ±åŒ—</option>
                        <option value="kanto">é–¢æ±</option>
                        <option value="tokyo">æ±äº¬éƒ½</option>
                        <option value="kanagawa">ç¥å¥ˆå·çœŒ</option>
                        <option value="saitama">åŸ¼ç‰çœŒ</option>
                        <option value="chiba">åƒè‘‰çœŒ</option>
                        <option value="nagano">é•·é‡çœŒ</option>
                        <option value="tokai">æ±æµ·</option>
                        <option value="kyoto">äº¬éƒ½åºœ</option>
                        <option value="osaka">å¤§é˜ªåºœ</option>
                        <option value="hyogo">å…µåº«çœŒ</option>
                        <option value="chugoku">ä¸­å›½åœ°æ–¹</option>
                        <option value="kyushu">ä¹å·</option>
                        <option value="okinawa">æ²–ç¸„çœŒ</option>
                    </select>
                </div>

                <button class="refresh-btn" onclick="refreshNews()" title="ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’æ›´æ–°">
                    <i class="fas fa-sync"></i>
                </button>
            </div>
        </div>

        <!-- é€Ÿå ±ãƒ‹ãƒ¥ãƒ¼ã‚¹ -->
        <section class="breaking-news-section-header">
            <div class="breaking-news-ticker" id="breakingNews">
                <!-- é€Ÿå ±ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒJavaScriptã§å‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
            </div>
        </section>

        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <nav class="navigation">
            <div class="nav-container">
                <div class="nav-tabs" id="categoryTabs">
                    <button class="nav-tab active" data-category="all">ã™ã¹ã¦</button>
                    <button class="nav-tab" data-category="regional">åœ°åŸŸãƒ»è¡Œæ”¿</button>
                    <button class="nav-tab" data-category="social">ç¤¾ä¼šãƒ»äº‹ä»¶</button>
                    <button class="nav-tab" data-category="sports">ã‚¹ãƒãƒ¼ãƒ„</button>
                    <button class="nav-tab" data-category="tourism">è¦³å…‰ã‚¹ãƒãƒƒãƒˆ</button>
                    <button class="nav-tab" data-category="gourmet">ã‚°ãƒ«ãƒ¡</button>
                    <button class="nav-tab" data-category="events">ã‚¤ãƒ™ãƒ³ãƒˆãƒ»ç¥­ã‚Š</button>
                    <button class="nav-tab" data-category="culture">æ–‡åŒ–ãƒ»èŠ¸è¡“</button>
                    <button class="nav-tab" data-category="transport">äº¤é€šãƒ»ã‚¢ã‚¯ã‚»ã‚¹</button>
                </div>
            </div>
        </nav>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-content">
        <div class="container">
            <!-- ãƒ¡ã‚¤ãƒ³ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚°ãƒªãƒƒãƒ‰ -->
            <section class="news-grid-section">
                <div class="news-grid" id="newsGrid">
                    <!-- ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰ãŒJavaScriptã§å‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                </div>
                <div class="load-more-container" id="loadMoreContainer" style="display: none;">
                    <button class="load-more-btn" id="loadMoreBtn">
                        <i class="fas fa-plus"></i>
                        ã‚‚ã£ã¨è¦‹ã‚‹
                    </button>
                </div>
            </section>

            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼æƒ…å ± -->
            <aside class="sidebar">
                <div class="trending-widget">
                    <h3><i class="fas fa-trending-up"></i> æ³¨ç›®ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</h3>
                    <div class="trending-tags">
                        <span class="tag">åœ°æ–¹å‰µç”Ÿ</span>
                        <span class="tag">è¦³å…‰æŒ¯èˆˆ</span>
                        <span class="tag">é˜²ç½å¯¾ç­–</span>
                        <span class="tag">å•†åº—è¡—æ´»æ€§åŒ–</span>
                        <span class="tag">ç§»ä½æ”¯æ´</span>
                        <span class="tag">è¾²æ¥­æŒ¯èˆˆ</span>
                    </div>
                </div>

                <div class="local-info-widget">
                    <h3><i class="fas fa-info-circle"></i> åœ°åŸŸæƒ…å ±</h3>
                    <div class="local-info-list">
                        <div class="info-item">
                            <i class="fas fa-calendar"></i>
                            <div>
                                <strong>å¸‚æ°‘ç¥­ã‚Š</strong>
                                <small>10æœˆ15æ—¥(æ—¥)</small>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-road"></i>
                            <div>
                                <strong>é“è·¯å·¥äº‹ã®ãŠçŸ¥ã‚‰ã›</strong>
                                <small>å›½é“1å·ç·š å¤œé–“é€šè¡Œæ­¢ã‚</small>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-hospital"></i>
                            <div>
                                <strong>ä¼‘æ—¥è¨ºç™‚</strong>
                                <small>ç”°ä¸­åŒ»é™¢ 9:00-17:00</small>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-section">
                <h4>Regional Report</h4>
                <p>åœ°åŸŸã«æ ¹ã–ã—ãŸæƒ…å ±ã‚’ãŠå±Šã‘ã—ã¾ã™</p>
            </div>
            <div class="footer-section">
                <h4>ã‚«ãƒ†ã‚´ãƒªãƒ¼</h4>
                <ul>
                    <li><a href="#">åœ°åŸŸãƒ‹ãƒ¥ãƒ¼ã‚¹</a></li>
                    <li><a href="#">ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±</a></li>
                    <li><a href="#">é˜²ç½æƒ…å ±</a></li>
                    <li><a href="#">ç”Ÿæ´»æƒ…å ±</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>ãŠå•ã„åˆã‚ã›</h4>
                <ul>
                    <li><a href="#">æƒ…å ±æä¾›</a></li>
                    <li><a href="#">åºƒå‘Šæ²è¼‰</a></li>
                    <li><a href="#">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a></li>
                    <li><a href="#">åˆ©ç”¨è¦ç´„</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹</h4>
                <div class="social-links">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Regional Report. All rights reserved.</p>
        </div>
    </footer>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
    </div>

    <!-- ãƒ‹ãƒ¥ãƒ¼ã‚¹è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="newsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-meta">
                    <span class="modal-source" id="modalSource"></span>
                    <span class="modal-date" id="modalDate"></span>
                </div>
                <div class="modal-image" id="modalImage"></div>
                <div class="modal-content-text" id="modalContent"></div>
                <div class="modal-tags" id="modalTags"></div>
            </div>
            <div class="modal-footer">
                <button class="share-btn">
                    <i class="fas fa-share"></i>
                    ã‚·ã‚§ã‚¢
                </button>
                <button class="bookmark-btn">
                    <i class="fas fa-bookmark"></i>
                    ä¿å­˜
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // OpenWeatherMap APIè¨­å®š
        const WEATHER_API_KEY = 'b8f58c3b4a8b4b5c9d8f7e6a5b4c3d2e'; // ãƒ‡ãƒ¢ã‚­ãƒ¼ï¼ˆå®Ÿéš›ã®ã‚­ãƒ¼ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
        const WEATHER_BASE_URL = 'https://api.openweathermap.org/data/2.5';

        // åœ°åŸŸã®åº§æ¨™ãƒãƒƒãƒ”ãƒ³ã‚°
        const regionCoordinates = {
            'all': { lat: 35.6762, lon: 139.6503, name: 'æ±äº¬' }, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯æ±äº¬
            'hokkaido': { lat: 43.2642, lon: 142.5454, name: 'åŒ—æµ·é“' },
            'tohoku': { lat: 38.7222, lon: 140.8694, name: 'æ±åŒ—' },
            'kanto': { lat: 35.6762, lon: 139.6503, name: 'é–¢æ±' },
            'tokyo': { lat: 35.6762, lon: 139.6503, name: 'æ±äº¬' },
            'kanagawa': { lat: 35.4478, lon: 139.6425, name: 'ç¥å¥ˆå·' },
            'saitama': { lat: 35.8617, lon: 139.6455, name: 'åŸ¼ç‰' },
            'chiba': { lat: 35.6074, lon: 140.1065, name: 'åƒè‘‰' },
            'nagano': { lat: 36.2048, lon: 138.1810, name: 'é•·é‡' },
            'tokai': { lat: 35.1802, lon: 136.9066, name: 'æ±æµ·' },
            'kyoto': { lat: 35.0116, lon: 135.7681, name: 'äº¬éƒ½' },
            'osaka': { lat: 34.6937, lon: 135.5023, name: 'å¤§é˜ª' },
            'hyogo': { lat: 34.6913, lon: 135.1830, name: 'å…µåº«' },
            'chugoku': { lat: 34.3853, lon: 132.4553, name: 'ä¸­å›½åœ°æ–¹' },
            'kyushu': { lat: 33.5904, lon: 130.4017, name: 'ä¹å·' },
            'okinawa': { lat: 26.2124, lon: 127.6792, name: 'æ²–ç¸„' }
        };

        // å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°
        const weatherIconMapping = {
            '01d': 'â˜€ï¸', '01n': 'ğŸŒ™',
            '02d': 'â›…', '02n': 'â˜ï¸',
            '03d': 'â˜ï¸', '03n': 'â˜ï¸',
            '04d': 'â˜ï¸', '04n': 'â˜ï¸',
            '09d': 'ğŸŒ§ï¸', '09n': 'ğŸŒ§ï¸',
            '10d': 'ğŸŒ¦ï¸', '10n': 'ğŸŒ§ï¸',
            '11d': 'â›ˆï¸', '11n': 'â›ˆï¸',
            '13d': 'â„ï¸', '13n': 'â„ï¸',
            '50d': 'ğŸŒ«ï¸', '50n': 'ğŸŒ«ï¸'
        };

        // å®Ÿéš›ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        async function fetchRealWeatherData(region) {
            console.log('ğŸŒ¤ï¸ å®Ÿéš›ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹:', region);
            const coordinates = regionCoordinates[region] || regionCoordinates['all'];

            try {
                // OpenWeatherMap OneCall APIï¼ˆ3æ—¥åˆ†ã®äºˆå ±ï¼‰
                const response = await fetch(`${WEATHER_BASE_URL}/forecast?lat=${coordinates.lat}&lon=${coordinates.lon}&appid=${WEATHER_API_KEY}&units=metric&lang=ja`);

                if (!response.ok) {
                    throw new Error('å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

                const data = await response.json();
                console.log('ğŸŒ¤ï¸ å¤©æ°—APIãƒ¬ã‚¹ãƒãƒ³ã‚¹:', data);

                // 3æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
                const weatherData = [];
                const today = new Date();

                for (let i = 0; i < 3; i++) {
                    // å„æ—¥ã®12:00ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯æœ€åˆã®ãƒ‡ãƒ¼ã‚¿ï¼‰
                    const targetDate = new Date(today);
                    targetDate.setDate(today.getDate() + i);
                    targetDate.setHours(12, 0, 0, 0);

                    const dayData = data.list.find(item => {
                        const itemDate = new Date(item.dt * 1000);
                        return itemDate.toDateString() === targetDate.toDateString();
                    }) || data.list[i * 8] || data.list[0]; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

                    if (dayData) {
                        const icon = weatherIconMapping[dayData.weather[0].icon] || 'â˜€ï¸';
                        const high = Math.round(dayData.main.temp_max);
                        const low = Math.round(dayData.main.temp_min);

                        weatherData.push({
                            date: i === 0 ? 'ä»Šæ—¥' : i === 1 ? 'æ˜æ—¥' : 'æ˜å¾Œæ—¥',
                            icon: icon,
                            high: high,
                            low: low
                        });
                    }
                }

                return weatherData;
            } catch (error) {
                console.error('ğŸŒ¤ï¸ å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
                return getFallbackWeatherData();
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆAPIãŒä½¿ç”¨ã§ããªã„å ´åˆï¼‰
        function getFallbackWeatherData() {
            console.log('ğŸŒ¤ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨');
            const weatherIcons = ['â˜€ï¸', 'â›…', 'â˜ï¸', 'ğŸŒ§ï¸'];
            const weatherData = [];

            for (let i = 0; i < 3; i++) {
                const iconIndex = Math.floor(Math.random() * weatherIcons.length);
                const high = Math.round(18 + Math.random() * 12);
                const low = Math.round(high - 5 - Math.random() * 3);

                weatherData.push({
                    date: i === 0 ? 'ä»Šæ—¥' : i === 1 ? 'æ˜æ—¥' : 'æ˜å¾Œæ—¥',
                    icon: weatherIcons[iconIndex],
                    high: high,
                    low: low
                });
            }
            return weatherData;
        }

        // å¤©æ°—äºˆå ±ã‚’è¡¨ç¤º
        async function displayWeatherForecast(region = 'all') {
            console.log('ğŸŒ¤ï¸ å¤©æ°—äºˆå ±è¡¨ç¤ºé–‹å§‹:', region);
            const weatherContainer = document.querySelector('.weather-forecast-scroll');
            const weatherLocation = document.getElementById('weatherLocation');

            if (!weatherContainer) return;

            // åœ°åŸŸåã‚’æ›´æ–°
            const coordinates = regionCoordinates[region] || regionCoordinates['all'];
            if (weatherLocation) {
                weatherLocation.textContent = `${coordinates.name}ã®å¤©æ°—`;
            }

            try {
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
                weatherContainer.innerHTML = '<div class="weather-loading">èª­ã¿è¾¼ã¿ä¸­...</div>';

                // å®Ÿéš›ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const weatherData = await fetchRealWeatherData(region);

                // HTMLã‚’ç”Ÿæˆã—ã¦è¡¨ç¤º
                const weatherHTML = weatherData.map(day => `
                    <div class="weather-day">
                        <div class="weather-date">${day.date}</div>
                        <div class="weather-icon">${day.icon}</div>
                        <div class="weather-temp">
                            <span class="weather-temp-high">${day.high}Â°</span>
                            <span class="weather-temp-low">${day.low}Â°</span>
                        </div>
                    </div>
                `).join('');

                weatherContainer.innerHTML = weatherHTML;
                console.log('ğŸŒ¤ï¸ å¤©æ°—äºˆå ±è¡¨ç¤ºå®Œäº†');
            } catch (error) {
                console.error('ğŸŒ¤ï¸ å¤©æ°—äºˆå ±è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
                weatherContainer.innerHTML = '<div class="weather-error">å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                displayWeatherForecast('all');
            }, 1000);

            // åœ°åŸŸé¸æŠå¤‰æ›´æ™‚ã®å‡¦ç†
            const regionSelect = document.getElementById('regionSelect');
            if (regionSelect) {
                regionSelect.addEventListener('change', function() {
                    displayWeatherForecast(this.value);
                });
            }
        });
    </script>
</body>
</html>