<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open-Meteoå¤©æ°—ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .weather-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .weather-day {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            min-width: 120px;
        }
        .weather-icon {
            font-size: 2em;
            margin: 10px 0;
        }
        .temp {
            font-weight: bold;
        }
        .high { color: #ff6b35; }
        .low { color: #1e90ff; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸŒ¤ï¸ Open-Meteoå¤©æ°—APIãƒ†ã‚¹ãƒˆ</h1>

    <div>
        <button onclick="testWeatherAPI('tokyo')">æ±äº¬ã®å¤©æ°—</button>
        <button onclick="testWeatherAPI('osaka')">å¤§é˜ªã®å¤©æ°—</button>
        <button onclick="testWeatherAPI('hokkaido')">åŒ—æµ·é“ã®å¤©æ°—</button>
        <button onclick="testWeatherAPI('okinawa')">æ²–ç¸„ã®å¤©æ°—</button>
    </div>

    <div class="weather-container" id="weatherDisplay">
        <!-- å¤©æ°—ãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
    </div>

    <div class="log" id="logDisplay">ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>

    <script>
        const WEATHER_BASE_URL = 'https://api.open-meteo.com/v1/forecast';

        // åœ°åŸŸã®åº§æ¨™ãƒãƒƒãƒ”ãƒ³ã‚°
        const regionCoordinates = {
            'all': { lat: 35.6762, lon: 139.6503, name: 'æ±äº¬' },
            'hokkaido': { lat: 43.2642, lon: 142.5454, name: 'åŒ—æµ·é“' },
            'tohoku': { lat: 38.7222, lon: 140.8694, name: 'æ±åŒ—' },
            'kanto': { lat: 35.6762, lon: 139.6503, name: 'é–¢æ±' },
            'tokyo': { lat: 35.6762, lon: 139.6503, name: 'æ±äº¬' },
            'kanagawa': { lat: 35.4478, lon: 139.6425, name: 'ç¥å¥ˆå·' },
            'saitama': { lat: 35.8617, lon: 139.6455, name: 'åŸ¼ç‰' },
            'chiba': { lat: 35.6074, lon: 140.1065, name: 'åƒè‘‰' },
            'nagano': { lat: 36.2048, lon: 138.1810, name: 'é•·é‡' },
            'tokai': { lat: 35.1802, lon: 136.9066, name: 'æ±æµ·' },
            'kyoto': { lat: 35.0116, lon: 135.7681, name: 'äº¬éƒ½' },
            'osaka': { lat: 34.6937, lon: 135.5023, name: 'å¤§é˜ª' },
            'hyogo': { lat: 34.6913, lon: 135.1830, name: 'å…µåº«' },
            'chugoku': { lat: 34.3853, lon: 132.4553, name: 'ä¸­å›½åœ°æ–¹' },
            'kyushu': { lat: 33.5904, lon: 130.4017, name: 'ä¹å·' },
            'okinawa': { lat: 26.2124, lon: 127.6792, name: 'æ²–ç¸„' }
        };

        // å¤©æ°—ã‚³ãƒ¼ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆWMO Weather interpretation codesï¼‰
        const weatherCodeMapping = {
            0: 'â˜€ï¸',     // Clear sky
            1: 'ğŸŒ¤ï¸',     // Mainly clear
            2: 'â›…',     // Partly cloudy
            3: 'â˜ï¸',     // Overcast
            45: 'ğŸŒ«ï¸',    // Fog
            48: 'ğŸŒ«ï¸',    // Depositing rime fog
            51: 'ğŸŒ¦ï¸',    // Light drizzle
            53: 'ğŸŒ¦ï¸',    // Moderate drizzle
            55: 'ğŸŒ§ï¸',    // Dense drizzle
            56: 'ğŸŒ§ï¸',    // Light freezing drizzle
            57: 'ğŸŒ§ï¸',    // Dense freezing drizzle
            61: 'ğŸŒ§ï¸',    // Slight rain
            63: 'ğŸŒ§ï¸',    // Moderate rain
            65: 'ğŸŒ§ï¸',    // Heavy rain
            66: 'ğŸŒ§ï¸',    // Light freezing rain
            67: 'ğŸŒ§ï¸',    // Heavy freezing rain
            71: 'â„ï¸',    // Slight snow fall
            73: 'â„ï¸',    // Moderate snow fall
            75: 'â„ï¸',    // Heavy snow fall
            77: 'â„ï¸',    // Snow grains
            80: 'ğŸŒ¦ï¸',    // Slight rain showers
            81: 'ğŸŒ§ï¸',    // Moderate rain showers
            82: 'ğŸŒ§ï¸',    // Violent rain showers
            85: 'â„ï¸',    // Slight snow showers
            86: 'â„ï¸',    // Heavy snow showers
            95: 'â›ˆï¸',    // Thunderstorm
            96: 'â›ˆï¸',    // Thunderstorm with slight hail
            99: 'â›ˆï¸'     // Thunderstorm with heavy hail
        };

        function log(message) {
            const logElement = document.getElementById('logDisplay');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        async function testWeatherAPI(region) {
            log(`ğŸŒ¤ï¸ ${region}ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’é–‹å§‹...`);

            const coordinates = regionCoordinates[region] || regionCoordinates['tokyo'];
            const url = `${WEATHER_BASE_URL}?latitude=${coordinates.lat}&longitude=${coordinates.lon}&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia/Tokyo&forecast_days=3`;

            log(`ğŸ“¡ API URL: ${url}`);

            try {
                const response = await fetch(url);
                log(`ğŸ“¨ APIãƒ¬ã‚¹ãƒãƒ³ã‚¹çŠ¶æ…‹: ${response.status} ${response.statusText}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                log(`âœ… APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡: ${JSON.stringify(data, null, 2)}`);

                // å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                displayWeatherData(coordinates.name, data);

            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        function displayWeatherData(regionName, data) {
            const weatherContainer = document.getElementById('weatherDisplay');

            log(`ğŸ¨ ${regionName}ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºä¸­...`);

            const weatherHTML = [];

            for (let i = 0; i < 3; i++) {
                const weatherCode = data.daily.weather_code[i];
                const tempMax = Math.round(data.daily.temperature_2m_max[i]);
                const tempMin = Math.round(data.daily.temperature_2m_min[i]);
                const icon = weatherCodeMapping[weatherCode] || 'â˜€ï¸';
                const dayLabel = i === 0 ? 'ä»Šæ—¥' : i === 1 ? 'æ˜æ—¥' : 'æ˜å¾Œæ—¥';

                weatherHTML.push(`
                    <div class="weather-day">
                        <div><strong>${dayLabel}</strong></div>
                        <div class="weather-icon">${icon}</div>
                        <div class="temp">
                            <span class="high">${tempMax}Â°</span> /
                            <span class="low">${tempMin}Â°</span>
                        </div>
                        <div style="font-size: 0.8em; color: #666;">
                            ã‚³ãƒ¼ãƒ‰: ${weatherCode}
                        </div>
                    </div>
                `);
            }

            weatherContainer.innerHTML = `
                <h3>${regionName}ã®3æ—¥é–“å¤©æ°—äºˆå ±</h3>
                <div style="display: flex; gap: 20px;">
                    ${weatherHTML.join('')}
                </div>
            `;

            log(`âœ… ${regionName}ã®å¤©æ°—è¡¨ç¤ºå®Œäº†`);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æ±äº¬ã®å¤©æ°—ã‚’è¡¨ç¤º
        window.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº† - æ±äº¬ã®å¤©æ°—ã‚’å–å¾—ã—ã¾ã™');
            testWeatherAPI('tokyo');
        });
    </script>
</body>
</html>