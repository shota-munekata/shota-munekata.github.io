// 実際のRSSフィードとAPIからのみニュースを取得（サンプルデータは削除）
const newsData = [];,
    {
        id: "tourism_hokkaido_2", 
        title: "札幌雪まつり2025、過去最大規模の雪像と氷の彫刻コンテスト開催",
        excerpt: "来年2月開催の札幌雪まつりで、過去最大となる高さ15メートルの雪像が制作予定。国際氷彫刻コンテストも同時開催されます。",
        content: "札幌雪まつり実行委員会は、2025年2月4日から11日まで開催される第75回さっぽろ雪まつりの概要を発表した。今回は過去最大規模となる高さ15メートル、幅30メートルの大雪像「北海道開拓の歴史」が大通公園4丁目会場に登場する。制作には自衛隊員約300名が参加し、約5,000トンの雪が使用される予定。また、今年から新たに「国際氷彫刻マスターズ」を開催し、世界12カ国のトップアーティストが技を競う。夜間は最新のプロジェクションマッピング技術を駆使した光の演出で雪像を彩り、幻想的な世界を演出。すすきの会場では透明度の高い支笏湖の氷を使用した氷の彫刻約60体が展示される。期間中は約200万人の来場者を見込んでいる。",
        image: "https://images.unsplash.com/photo-1548273887-52d4b599b3d8?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "hokkaido", 
        source: "札幌市観光文化局",
        publishedAt: "2024-09-02T14:30:00",
        isBreaking: false,
        tags: ["雪まつり", "イベント", "氷彫刻"],
        originalUrl: "https://example.com/news/sapporo-snow-festival-2025"
    },
    {
        id: "tourism_hokkaido_3",
        title: "知床半島で流氷ウォーキングツアー解禁、野生動物との遭遇も",
        excerpt: "世界自然遺産・知床半島で流氷の上を歩く特別ツアーがスタート。アザラシやオジロワシなど野生動物との出会いが期待できます。",
        content: "知床自然ガイド協会は、世界自然遺産である知床半島で「流氷ウォーキングツアー」の受付を開始した。1月15日から3月15日までの期間限定で、厚さ30cm以上の安全な流氷の上を専門ガイドと共に歩く貴重な体験ができる。ツアーでは特製のドライスーツを着用し、流氷の隙間から顔を出すアザラシや、魚を狙うオジロワシ、オオワシなどの野生動物を間近で観察できる。参加者からは「まるで極地探検家になったような感動的な体験だった」との声が寄せられている。1日2回（午前9時、午後1時）、各回最大8名まで。料金は大人12,000円、装備レンタル込み。事前講習会への参加が必須で、安全管理も徹底。知床斜里町観光協会では「知床でしか体験できない奇跡の自然現象を肌で感じてほしい」としている。",
        image: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "hokkaido",
        source: "知床斜里町観光協会", 
        publishedAt: "2024-09-01T16:45:00",
        isBreaking: false,
        tags: ["知床", "流氷", "野生動物"],
        originalUrl: "https://example.com/news/shiretoko-drift-ice-walking"
    },
    {
        id: "tourism_hokkaido_4",
        title: "小樽運河で「キャンドルナイト2024」開催、2万本のキャンドルが水面を照らす",
        excerpt: "小樽運河沿いに2万本のキャンドルが灯る幻想的なイベント。雪景色とキャンドルの光が織りなす美しい冬の風物詩です。",
        content: "小樽市は12月23日から25日まで、小樽運河で「小樽雪あかりの路キャンドルナイト2024」を開催する。今年は過去最多となる2万本のキャンドルが運河沿い1.2kmにわたって設置され、雪化粧した石造倉庫群と共に幻想的な景色を演出する。メイン会場となる浅草橋では、地元小学生が制作した雪だるまキャンドルホルダー500個が並び、温かな光で来場者を迎える。また、運河クルーズ船からキャンドルの灯りを眺める「ナイトクルーズ」（大人1,500円）も特別運航される。点灯時間は午後5時から9時まで。小樽観光協会の山田会長は「雪とキャンドルが織りなす小樽ならではの美しい冬の夜をお楽しみください」と話している。期間中は小樽駅から無料シャトルバスも運行される。",
        image: "https://images.unsplash.com/photo-1577717903315-1691ae25ab3f?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "hokkaido",
        source: "小樽市観光協会",
        publishedAt: "2024-09-02T11:20:00", 
        isBreaking: false,
        tags: ["小樽運河", "キャンドル", "冬イベント"],
        originalUrl: "https://example.com/news/otaru-candle-night-2024"
    },
    {
        id: "tourism_hokkaido_5",
        title: "登別温泉で新たな源泉発見、100年ぶりの新湯「美肌の湯」誕生",
        excerpt: "登別温泉で約100年ぶりに新たな源泉が発見され、美肌効果の高い「美肌の湯」として注目を集めています。",
        content: "登別温泉観光協会は、地獄谷近くで新たな温泉源泉が発見されたと発表した。この新源泉は約100年ぶりの発見で、泉質は含硫黄ナトリウム塩化物泉。特に美肌効果が高いことから「美肌の湯」と命名された。湯温は62度、毎分180リットルの豊富な湯量を誇る。成分分析の結果、メタケイ酸の含有量が通常の温泉の3倍以上と判明し、肌の新陳代謝を促進する効果が期待される。登別グランドホテルでは来年1月から新源泉を使用した露天風呂「美肌の湯」を新設予定。また、源泉の一部は化粧水としても商品化される計画で、地域の新たな観光資源として期待が高まっている。登別市長は「100年に一度の奇跡的な発見。登別温泉の新たな魅力として国内外に発信したい」とコメント。",
        image: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=250&fit=crop&q=80",
        category: "tourism", 
        region: "hokkaido",
        source: "登別市観光振興課",
        publishedAt: "2024-09-01T13:10:00",
        isBreaking: false,
        tags: ["温泉", "新源泉", "美肌効果"],
        originalUrl: "https://example.com/news/noboribetsu-new-hot-spring"
    },

    // 東京
    {
        id: "tourism_tokyo_1", 
        title: "東京スカイツリータウンに新展望デッキ「雲上の庭」オープン",
        excerpt: "東京スカイツリーに高さ500メートルの新展望デッキが誕生。360度のパノラマビューと空中庭園が楽しめる新名所です。",
        content: "東京スカイツリータウンは、地上500メートルに位置する新展望デッキ「雲上の庭」を12月15日にオープンすると発表した。これまでの最高展望デッキより50メートル高く、関東平野を一望できる360度のパノラマビューが楽しめる。特徴的なのは展望デッキに設置された「空中庭園」で、高さ500メートルの空間に四季の花々が植えられ、雲の上にいるような非日常体験を提供する。また、透明な強化ガラスの床「スカイウォーク」では、真下500メートルの景色を見下ろすスリルある体験も可能。夜間は関東最大級のイルミネーション「天空の光の森」が庭園を彩り、まるで星空の中を歩いているような感覚を味わえる。入場料は大人3,200円、事前予約制。東武鉄道では「雲に一番近い展望デッキで、新たな東京の魅力を発信したい」としている。",
        image: "https://images.unsplash.com/photo-1513407030348-c983a97b98d8?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "tokyo",
        source: "東武タワースカイツリー",
        publishedAt: "2024-09-02T10:30:00",
        isBreaking: false,
        tags: ["スカイツリー", "展望デッキ", "新名所"],
        originalUrl: "https://example.com/news/skytree-cloud-garden"
    },
    {
        id: "tourism_tokyo_2",
        title: "浅草に江戸時代の街並み再現テーマパーク「江戸ワンダーランド東京」開業",
        excerpt: "浅草に江戸時代の文化と街並みを完全再現したテーマパークが誕生。忍者ショーや江戸グルメが楽しめる新スポット。",
        content: "浅草に江戸時代の街並みと文化を完全再現したテーマパーク「江戸ワンダーランド東京」が来年3月にオープンする。約2万平方メートルの敷地に、江戸時代の町屋、武家屋敷、寺社を忠実に再現。来場者は無料で江戸時代の衣装をレンタルでき、町人や武士、忍者の格好で園内を回遊できる。メインアトラクションは実際の忍者が演じる「忍者アクションショー」で、1日6回開催。江戸時代の職人技を体験できる「江戸職人工房」では、和紙作り、藍染め、刀鍛冶の実演見学が可能。グルメエリアでは江戸前寿司、そば、天ぷらなど江戸グルメを当時の調理法で再現。特に人気は「将軍様御膳」（3,800円）で、江戸城で実際に提供されていたメニューを味わえる。入園料は大人2,500円、江戸衣装レンタル込み。台東区では「江戸の魅力を世界に発信する新たな観光拠点」として期待を寄せている。",
        image: "https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=400&h=250&fit=crop&q=80", 
        category: "tourism",
        region: "tokyo",
        source: "台東区観光課",
        publishedAt: "2024-09-01T15:20:00",
        isBreaking: false,
        tags: ["江戸時代", "テーマパーク", "浅草"],
        originalUrl: "https://example.com/news/edo-wonderland-tokyo"
    },
    {
        id: "tourism_tokyo_3",
        excerpt: "市内中心部に新たな展望施設がオープン。360度のパノラマビューが楽しめる話題の新スポットとして注目を集めている。",
        content: "市内中心部に建設された新展望タワー『スカイビューレット』が本日グランドオープンを迎えた。地上120メートルの高さから市内を一望でき、晴れた日には遠くの山々まで見渡すことができる。展望フロアにはカフェも併設されており、絶景を眺めながらゆったりとした時間を過ごすことができる。入場料は大人1,500円、子供800円。",
        image: "https://images.unsplash.com/photo-1519501025264-65ba15a82390?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "tokyo",
        source: "東京観光情報",
        publishedAt: "2024-09-01T10:30:00",
        isBreaking: false,
        tags: ["観光", "展望", "新オープン"],
        originalUrl: "https://example.com/news/tower-opening"
    },
    {
        id: "2",
        title: "【速報】台風接近により観光地アクセス一部制限",
        excerpt: "台風の接近に伴い、山間部の観光地への道路アクセスが一部制限されています。観光予定の方は最新情報をご確認ください。",
        content: "気象庁の発表によると、大型台風が接近中のため、山間部の観光地への主要道路で通行止めや片側交互通行の措置が取られています。特に○○渓谷、××高原への県道は午後3時から通行止めとなる予定です。観光を予定されている方は、各観光地の公式サイトや交通情報をご確認の上、安全を最優先に行動してください。",
        image: "https://images.unsplash.com/photo-1561553873-e8491a564fd0?w=400&h=250&fit=crop&q=80",
        category: "breaking",
        region: "tokyo",
        source: "観光安全情報センター",
        publishedAt: "2024-09-01T14:45:00",
        isBreaking: true,
        tags: ["速報", "台風", "アクセス情報"]
    },
    {
        id: "3",
        title: "創業100周年の老舗和菓子店で限定スイーツが話題",
        excerpt: "昭和区にある老舗和菓子店「松月堂」が創業100周年を迎え、記念限定スイーツを販売。伝統の技と新しいアイデアが融合した逸品。",
        content: "昭和区商店街にある老舗和菓子店「松月堂」が創業100周年を迎え、記念限定スイーツ『百年桜』を販売している。大正13年に初代店主が創業して以来、4代にわたって伝統の製法を受け継いできた老舗の新作は、桜餡と抹茶クリームを和三盆で包んだ上品な一品。4代目店主・松本武志さん（58）は「伝統を守りつつ、新しいお客様にも愛される味を」と語る。限定100個、一日20個限定販売で既に話題となっている。",
        image: "https://images.unsplash.com/photo-1563822249366-6a7b2c9a0193?w=400&h=250&fit=crop&q=80",
        category: "gourmet",
        region: "osaka",
        source: "大阪グルメ情報",
        publishedAt: "2024-09-01T09:15:00",
        isBreaking: false,
        tags: ["グルメ", "和菓子", "限定商品"]
    },
    {
        id: "4",
        title: "秋の収穫体験イベントが各地で開催中",
        excerpt: "県内各地で秋の味覚狩りイベントが開催されています。りんご狩り、ぶどう狩り、栗拾いなど家族で楽しめる体験が盛りだくさん。",
        content: "県内の観光農園では秋の収穫体験イベントが本格的にスタートしている。特に人気なのは、○○農園のりんご狩り（入園料大人800円）、××ぶどう園のぶどう狩り（食べ放題1,200円）、△△山の栗拾い（1kg持ち帰り500円）など。どの農園も完全予約制となっており、週末は家族連れで賑わっている。収穫した果物はその場で味わうことができ、お土産として持ち帰ることも可能。期間は11月末まで。",
        image: "https://images.unsplash.com/photo-1560707303-4e980ce876ad?w=400&h=250&fit=crop&q=80",
        category: "events",
        region: "kanagawa",
        source: "神奈川観光協会",
        publishedAt: "2024-09-01T11:20:00",
        isBreaking: false,
        tags: ["体験", "収穫", "家族向け"]
    },
    {
        id: "5",
        title: "伝統工芸体験ワークショップが好評開催中",
        excerpt: "地元の陶芸家による陶芸体験や、職人による木工体験など、伝統工芸を学べるワークショップが観光客に大人気。",
        content: "市内の文化センターで開催中の伝統工芸体験ワークショップが観光客から高い評価を得ている。地元の陶芸家・田中さんによる陶芸体験（2時間3,000円）では、湯呑みや小皿作りに挑戦でき、作品は後日郵送される。また、木工職人・佐藤さんの木工体験（90分2,500円）では、箸やコースターなど実用的な小物を制作できる。参加者からは「プロの技術を間近で見られて勉強になった」「旅の良い思い出になった」と好評の声が寄せられている。",
        image: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=250&fit=crop&q=80",
        category: "culture",
        region: "saitama",
        source: "埼玉文化情報",
        publishedAt: "2024-08-31T18:30:00",
        isBreaking: false,
        tags: ["伝統工芸", "体験", "ワークショップ"]
    },
    {
        id: "6",
        title: "地元ブランド商店街で秋の大セール開催",
        excerpt: "老舗商店街で秋の大セールが開催中。地元特産品から手作り雑貨まで、ここでしか買えない商品が特別価格で販売されています。",
        content: "市内中心部にある○○商店街で秋の大セールが開催されている。期間は9月1日から15日まで。地元特産品の蜂蜜やジャム、手作り陶器、伝統織物など、ここでしか手に入らない商品が通常価格の20-30%オフで販売されている。特に人気なのは地元作家の手作りアクセサリーや、老舗茶屋の特製和菓子セット。商店街振興会の山田会長は「観光客の皆様に地元の魅力を知っていただく良い機会」とコメント。週末にはワゴンセールも予定されている。",
        image: "https://images.unsplash.com/photo-1472851294608-062f824d29cc?w=400&h=250&fit=crop&q=80",
        category: "shopping",
        region: "chiba",
        source: "千葉商業情報",
        publishedAt: "2024-09-01T08:45:00",
        isBreaking: false,
        tags: ["ショッピング", "セール", "地元ブランド"]
    },
    {
        id: "7",
        title: "観光地の温泉旅館で秋の宿泊プラン開始",
        excerpt: "山間部の温泉地で紅葉を楽しむ秋の宿泊プランが開始。露天風呂から紅葉を眺めながらの温泉体験が人気を集めています。",
        content: "県内有数の温泉地○○温泉で、紅葉シーズンに合わせた特別宿泊プランが開始された。参加旅館は全15軒で、露天風呂付き客室プラン（1泊2食付き15,000円から）や、紅葉狩り散策付きプラン（1泊2食+ガイド付き散策18,000円から）などを用意。特に人気なのは、朝食前の早朝温泉と紅葉鑑賞がセットになった『早起き紅葉プラン』。温泉旅館組合の理事長は「今年は紅葉の色づきが良く、絶好の観光シーズンになりそう」とコメントしている。",
        image: "https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=400&h=250&fit=crop&q=80",
        category: "accommodation",
        region: "all",
        source: "温泉観光協会",
        publishedAt: "2024-09-01T17:00:00",
        isBreaking: false,
        tags: ["温泉", "宿泊", "紅葉"]
    },
    {
        id: "8",
        title: "週末限定シャトルバスで観光スポット巡りが便利に",
        excerpt: "主要な観光スポットを結ぶ週末限定シャトルバスの運行が開始。1日券で市内の名所を効率よく回ることができます。",
        content: "市内の主要観光スポットを結ぶ週末限定シャトルバス『○○周遊バス』の運行が開始された。土日祝日の午前9時から午後5時まで、30分間隔で運行し、市内の主要な観光地15箇所を結んでいる。1日乗車券は大人500円、子供250円で、各観光施設での割引特典も付いている。特に好評なのは、車内での観光案内アナウンスと、運転手による地元情報の提供。観光協会によると「車を持たない観光客からの要望が多く、念願の運行開始となった」とのこと。",
        image: "https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?w=400&h=250&fit=crop&q=80",
        category: "transport",
        region: "kyoto",
        source: "京都観光協会",
        publishedAt: "2024-08-31T15:20:00",
        isBreaking: false,
        tags: ["交通", "シャトルバス", "観光"]
    },
    // 観光スポット記事
    {
        id: "9",
        title: "江戸時代の城跡で新しい発見、考古学調査が話題",
        excerpt: "市内の城跡で行われている発掘調査で、江戸時代の貴重な遺物が発見され、歴史ファンの注目を集めています。",
        content: "市内中央部にある○○城跡で行われている考古学調査で、江戸時代中期の陶磁器や武具の一部が発見された。これらの遺物は当時の武士の生活を物語る貴重な資料として、専門家から高い評価を受けている。現在、発掘現場では一般向けの見学ツアーも開催されており、歴史愛好家だけでなく観光客からも人気を集めている。見学ツアーは平日午前10時と午後2時の2回、参加費は大人500円、学生300円。要予約。",
        image: "https://images.unsplash.com/photo-1518005020951-eccb494ad742?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "tokyo",
        source: "東京歴史協会",
        publishedAt: "2024-09-01T16:15:00",
        isBreaking: false,
        tags: ["観光", "歴史", "城跡"]
    },
    {
        id: "10",
        title: "湖畔の絶景スポットに新しい展望デッキが完成",
        excerpt: "人気の湖畔リゾートエリアに、360度の絶景を楽しめる展望デッキがオープン。夕日の美しさで知られる新たな撮影スポットとして注目されています。",
        content: "県内有数の観光地○○湖畔に、新しい展望デッキ「レイクビューテラス」がオープンした。湖面から高さ15メートルの位置に設置されたデッキからは、湖とその周辺の山々を360度見渡すことができ、特に夕日の時間帯は息をのむ美しさだという。デッキには休憩スペースとカフェコーナーも併設され、地元産のコーヒーや軽食を楽しみながら景色を堪能できる。入場料は大人300円、子供150円。営業時間は午前9時から午後8時まで。",
        image: "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "kanagawa",
        source: "神奈川観光局",
        publishedAt: "2024-09-01T14:30:00",
        isBreaking: false,
        tags: ["観光", "絶景", "湖畔"]
    },
    {
        id: "11",
        title: "古刹の紅葉ライトアップが今年も開催決定",
        excerpt: "1200年の歴史を持つ古刹で、恒例の紅葉ライトアップが11月に開催されます。幻想的な光に照らされた紅葉が織りなす美の世界をお楽しみください。",
        content: "市内にある1200年の歴史を誇る○○寺で、恒例の紅葉ライトアップが11月15日から30日まで開催される。境内の約200本のもみじが特別な照明で照らされ、昼間とは異なる幻想的な美しさを演出する。今年は新たにプロジェクションマッピングも導入され、本堂の壁面に季節の花々や寺の歴史を映し出す演出も加わった。ライトアップ時間は午後5時から午後9時まで。入場料は大人800円、中高生500円、小学生300円。期間中は僧侶による法話や抹茶の接待サービスも予定されている。",
        image: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "kyoto",
        source: "京都寺院観光協会",
        publishedAt: "2024-08-31T19:00:00",
        isBreaking: false,
        tags: ["観光", "寺院", "ライトアップ"]
    },
    {
        id: "12",
        title: "テーマパークに新アトラクション「天空の冒険」登場",
        excerpt: "人気テーマパークに高さ50メートルの新アトラクションが登場。VR技術を駆使したスリル満点の空中体験が楽しめます。",
        content: "市内の人気テーマパーク「○○ランド」に、新アトラクション「天空の冒険」がオープンした。地上50メートルの高さに設置されたコースターは、最新のVR技術と組み合わせることで、空を飛んでいるような感覚を体験できる。アトラクションでは、利用者がVRゴーグルを装着し、架空の世界を飛行する映像と実際のコースターの動きが連動する仕組み。1回の乗車時間は約5分で、定員は20名。身長制限は120cm以上。開園30周年記念として建設され、総工費は約15億円。週末には整理券が必要になるほどの人気ぶりだという。",
        image: "https://images.unsplash.com/photo-1495020689067-958852a7765e?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "osaka",
        source: "大阪エンタメ情報",
        publishedAt: "2024-09-01T12:45:00",
        isBreaking: false,
        tags: ["観光", "テーマパーク", "VR"]
    },
    {
        id: "13",
        title: "国定公園の新トレッキングコースがオープン",
        excerpt: "自然豊かな国定公園に、初心者から上級者まで楽しめる新しいトレッキングコースが整備されました。四季折々の自然美を堪能できます。",
        content: "○○国定公園に3つの難易度に分かれた新トレッキングコースがオープンした。初心者向けの「森林浴コース」（所要時間1時間）、中級者向けの「展望台コース」（所要時間2.5時間）、上級者向けの「山頂制覇コース」（所要時間4時間）が整備され、それぞれ異なる自然の魅力を楽しめる。コース沿いには休憩所や案内板も設置され、安全に楽しめるよう配慮されている。公園管理事務所では、ガイド付きツアーも実施しており、専門ガイドが植物や野鳥について詳しく解説してくれる。入園料は大人400円、子供200円。ガイドツアーは別途1,000円。",
        image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "saitama",
        source: "埼玉自然保護協会",
        publishedAt: "2024-08-31T08:20:00",
        isBreaking: false,
        tags: ["観光", "ハイキング", "自然"]
    },
    {
        id: "14",
        title: "海岸沿いの遊歩道が全面リニューアル完了",
        excerpt: "人気の海岸リゾートエリアの遊歩道が全面改修され、より安全で美しい散策路として生まれ変わりました。夕日スポットとしても人気です。",
        content: "県内屈指の海岸リゾート地○○海岸の遊歩道リニューアル工事が完了し、全長2.5kmの美しい散策路として再オープンした。新しい遊歩道には、波しぶき対策の防護柵、休憩用のベンチ、夜間照明設備が整備され、安全性と利便性が大幅に向上した。途中3箇所に設けられた展望スペースからは、太平洋の雄大な景色を一望できる。特に夕日の時間帯は絶景スポットとして多くの観光客が訪れている。遊歩道沿いには地元アーティストによるオブジェも設置され、アートを楽しみながらの散策も可能。24時間利用可能で入場料は無料。",
        image: "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "chiba",
        source: "千葉海岸観光協会",
        publishedAt: "2024-08-30T17:30:00",
        isBreaking: false,
        tags: ["観光", "海岸", "遊歩道"]
    },
    {
        id: "15",
        title: "歴史的建造物の特別公開が期間限定で実施",
        excerpt: "通常は非公開の明治時代の洋館が特別公開されます。当時の生活様式を再現した展示や、建築技術の解説も行われます。",
        content: "明治20年に建設された洋館「○○邸」の特別公開が、10月1日から31日まで実施される。この洋館は通常一般公開されていないが、文化財保護月間に合わせて年1回だけ特別に公開されている。館内では明治時代の上流階級の生活様式を再現した展示や、当時の建築技術、使用された輸入建材についての詳しい解説が行われる。見学ツアーは1日4回（10:00, 12:00, 14:00, 16:00）実施され、各回定員20名の完全予約制。参加費は大人1,200円、学生800円。建築愛好家や歴史ファンからの問い合わせが殺到しており、早めの予約がおすすめ。",
        image: "https://images.unsplash.com/photo-1518005020951-eccb494ad742?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "tokyo",
        source: "東京文化財保護協会",
        publishedAt: "2024-08-30T15:45:00",
        isBreaking: false,
        tags: ["観光", "歴史", "洋館"]
    },
    {
        id: "16",
        title: "ロープウェイからの絶景が楽しめる山頂展望台",
        excerpt: "標高800メートルの山頂展望台へのロープウェイが運行再開。紅葉シーズンを迎え、空中散歩と絶景のコンビネーションが話題です。",
        content: "点検のため一時運休していた○○山ロープウェイが運行を再開し、多くの観光客で賑わっている。標高800メートルの山頂駅まで約10分の空中散歩を楽しめ、山頂の展望台からは360度の大パノラマが広がる。特に今の時期は紅葉が見頃を迎えており、眼下に広がる色とりどりの山々は圧巻の美しさ。山頂駅には「雲上カフェ」も併設されており、絶景を眺めながら地元産の高原野菜を使ったスープや、山の湧水で淹れたコーヒーを味わえる。往復料金は大人1,800円、子供900円。営業時間は9:00-17:00（11月からは16:30まで）。",
        image: "https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "kanagawa",
        source: "神奈川山岳観光協会",
        publishedAt: "2024-08-30T11:20:00",
        isBreaking: false,
        tags: ["観光", "ロープウェイ", "展望台"]
    },
    {
        id: "17",
        title: "水族館の新エリア「深海の世界」がオープン",
        excerpt: "市内人気水族館に深海生物をテーマにした新エリアが登場。最新技術を使った幻想的な展示で、神秘的な深海の世界を体験できます。",
        content: "市内の人気水族館「○○アクアリウム」に新エリア「深海の世界」がグランドオープンした。水深1000メートル以下に生息する珍しい深海生物約50種類を展示し、特殊な照明技術により深海の神秘的な環境を再現している。目玉展示は世界的にも珍しい生きたダイオウイカの幼体や、光る深海魚たち。360度ドーム型シアターでは深海探査の映像も上映されている。新エリアの建設費は約8億円で、3年の歳月をかけて完成した。入館料は大人2,400円、中高生1,800円、小学生1,200円（新エリア込み）。平日でも多くの家族連れで賑わっている。",
        image: "https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "osaka",
        source: "大阪水族館協会",
        publishedAt: "2024-08-30T09:15:00",
        isBreaking: false,
        tags: ["観光", "水族館", "深海"]
    },
    {
        id: "18",
        title: "桜の名所で来春のライトアップ計画が発表",
        excerpt: "市内屈指の桜の名所で、来春のライトアップイベントの詳細が発表されました。新しい演出も加わり、より幻想的な夜桜を楽しめそうです。",
        content: "市内の桜の名所として知られる○○公園で、来年春の夜桜ライトアップイベントの詳細が発表された。約1000本の桜を最新のLED照明で照らし、音楽と光の演出を組み合わせた「桜ファンタジー」を開催予定。今回新たに導入される演出では、桜の開花状況に合わせて照明の色彩を変化させる技術を使用する。期間は4月上旬から中旬の約2週間、時間は午後6時から午後10時まで。園内には期間限定の屋台村も設置され、地元グルメを楽しみながら夜桜鑑賞ができる。入園料は大人500円、子供200円。昨年は期間中約15万人が来場した人気イベント。",
        image: "https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "tokyo",
        source: "東京公園管理局",
        publishedAt: "2024-08-29T20:00:00",
        isBreaking: false,
        tags: ["観光", "桜", "ライトアップ"]
    },
    // グルメ記事
    {
        id: "19",
        title: "老舗そば処の新メニュー「十割そば」が話題",
        excerpt: "創業80年の老舗そば店が、地元産そば粉100%使用の十割そばを新発売。そば本来の風味と香りが楽しめると食通の間で評判です。",
        content: "市内で創業80年を誇る老舗そば処「○○庵」が、地元産そば粉を100%使用した「十割そば」を新メニューとして発売した。通常のそばには小麦粉が混ぜられることが多いが、この十割そばはそば粉のみで作られており、そば本来の深い味わいと香りを楽しめる。そば粉は地元の契約農家から直接仕入れており、石臼挽きで丁寧に製粉されている。価格は普通盛り1,200円、大盛り1,500円。土日祝日は行列ができるほどの人気で、そば愛好家や観光客が足繁く通っている。店主の田中さんは「先代から受け継いだ味を大切にしながら、新しい挑戦も続けたい」と語る。",
        image: "https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?w=400&h=250&fit=crop&q=80",
        category: "gourmet",
        region: "saitama",
        source: "埼玉グルメ情報",
        publishedAt: "2024-09-01T13:30:00",
        isBreaking: false,
        tags: ["グルメ", "そば", "老舗"]
    },
    {
        id: "20",
        title: "海鮮丼専門店に新鮮な地魚を使った限定メニュー",
        excerpt: "港町の海鮮丼専門店で、地元漁港で水揚げされた新鮮な地魚を使った季節限定メニューが登場。漁師直送の魚介類が味わえます。",
        content: "港町に位置する海鮮丼専門店「○○丸」で、地元漁港直送の新鮮な地魚を使った季節限定メニュー「漁師のまかない丼」が好評を博している。このメニューは、その日の朝に水揚げされた魚介類を使用するため、日によって内容が変わるのが特徴。アジ、サバ、イワシなどの地魚に加え、時期によってはヒラメやタイなども登場する。価格は1,800円で、味噌汁と小鉢が付く。店主の海野さんは元漁師で、魚の目利きには絶対の自信を持つ。「東京からわざわざ食べに来る人もいる」と話すほど、口コミで人気が広がっている。営業は11:30-14:00の昼のみ。売り切れ次第終了。",
        image: "https://images.unsplash.com/photo-1518005020951-eccb494ad742?w=400&h=250&fit=crop&q=80",
        category: "gourmet",
        region: "chiba",
        source: "千葉海鮮情報",
        publishedAt: "2024-09-01T12:00:00",
        isBreaking: false,
        tags: ["グルメ", "海鮮丼", "地魚"]
    },
    {
        id: "21",
        title: "古民家カフェで味わう地元野菜のオーガニックランチ",
        excerpt: "築150年の古民家を改装したカフェで、地元農家直送の有機野菜を使ったランチセットが人気。ノスタルジックな空間で心温まる食事を。",
        content: "築150年の古民家を丁寧に改装したカフェ「○○の家」で、地元農家から直送される有機野菜をふんだんに使ったランチセットが評判を呼んでいる。メニューは「季節野菜のオーガニックプレート」（1,650円）で、10種類以上の野菜料理が色鮮やかに盛り付けられている。使用される野菜はすべて無農薬・有機栽培で、契約している5軒の農家から毎朝直送されている。古民家の梁や柱はそのまま活かされ、囲炉裏や土間も当時のまま保存されている。店内からは美しい日本庭園も眺められ、都市部では味わえない贅沢な時間を過ごせる。営業時間は11:00-16:00、定休日は火曜日。予約がおすすめ。",
        image: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=250&fit=crop&q=80",
        category: "gourmet",
        region: "kanagawa",
        source: "神奈川カフェガイド",
        publishedAt: "2024-08-31T16:45:00",
        isBreaking: false,
        tags: ["グルメ", "カフェ", "オーガニック"]
    },
    {
        id: "22",
        title: "地酒と郷土料理が楽しめる居酒屋が新オープン",
        excerpt: "地元の酒蔵で作られた日本酒と、伝統的な郷土料理を味わえる居酒屋がオープン。地域の食文化を再発見できる空間として注目されています。",
        content: "地元の食文化を発信する居酒屋「○○酒場」が市内中心部にオープンし、地酒愛好家や観光客の間で話題となっている。店内では地元の3つの酒蔵で醸造された日本酒を常時15種類取り揃え、それぞれに合う郷土料理を提供している。人気メニューは「地鶏の炭火焼き」（1,200円）や「山菜の天ぷら」（900円）、「川魚の甘露煮」（800円）など。店主の山田さんは「地域の食材と酒造りの伝統を若い世代にも知ってもらいたい」と語る。カウンター8席、テーブル席16席の落ち着いた雰囲気で、一人でも気軽に立ち寄れる。営業時間は17:00-24:00、日曜定休。",
        image: "https://images.unsplash.com/photo-1495020689067-958852a7765e?w=400&h=250&fit=crop&q=80",
        category: "gourmet",
        region: "kyoto",
        source: "京都グルメ情報局",
        publishedAt: "2024-08-31T19:30:00",
        isBreaking: false,
        tags: ["グルメ", "居酒屋", "地酒"]
    },
    {
        id: "23",
        title: "行列のできるラーメン店に新作「味噌ラーメン」登場",
        excerpt: "地元で20年愛され続けるラーメン店が、満を持して味噌ラーメンを新発売。独自の味噌ブレンドと秘伝のスープが絶妙な味わいを生み出します。",
        content: "開店20年を迎える人気ラーメン店「○○軒」が、新メニュー「特製味噌ラーメン」の提供を開始した。これまで醤油と塩ラーメンのみで勝負してきた同店が、1年間の試行錯誤を経てついに味噌ラーメンを完成させた。スープは3種類の味噌をブレンドし、豚骨と鶏ガラを12時間煮込んだ秘伝のダシと組み合わせている。トッピングには炙りチャーシュー、味玉、もやし、ネギ、コーンがのり、価格は950円。開店当初から通う常連客からも「これまでで一番美味い」と絶賛の声が上がっている。平日でも開店前から行列ができ、土日は2時間待ちも珍しくない。営業時間は11:00-15:00、18:00-21:00。",
        image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=250&fit=crop&q=80",
        category: "gourmet",
        region: "tokyo",
        source: "東京ラーメン情報",
        publishedAt: "2024-08-31T14:20:00",
        isBreaking: false,
        tags: ["グルメ", "ラーメン", "新作"]
    },
    {
        id: "24",
        title: "フルーツパフェ専門店が季節限定「柿パフェ」を発売",
        excerpt: "地元産フルーツを使ったパフェで人気の専門店が、秋の味覚「柿」を使った期間限定パフェを発売。甘く熟した柿の美味しさを堪能できます。",
        content: "地元産フルーツにこだわったパフェ専門店「○○パフェテリア」で、秋の味覚を代表する柿を使った期間限定「柿パフェ」の販売が始まった。使用される柿は県内の農園から直送される甘柿で、完熟した柿本来の濃厚な甘さが楽しめる。パフェには柿のコンポート、柿のムース、柿のソルベが層になって盛り付けられ、アクセントにクルミとシナモンが加えられている。価格は1,380円で、11月末までの期間限定販売。同店では年間を通じて季節のフルーツを使ったパフェを提供しており、地元住民だけでなく観光客からも人気が高い。営業時間は10:00-19:00、月曜定休。テイクアウトも可能。",
        image: "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&h=250&fit=crop&q=80",
        category: "gourmet",
        region: "osaka",
        source: "大阪スイーツ情報",
        publishedAt: "2024-08-30T15:30:00",
        isBreaking: false,
        tags: ["グルメ", "パフェ", "季節限定"]
    },
    // イベント・祭り記事
    {
        id: "25",
        title: "紅葉まつりが10月中旬から開催、ライトアップも実施",
        excerpt: "市内最大の紅葉の名所で恒例の紅葉まつりが開催されます。期間中は夜間ライトアップや地元グルメの屋台も登場し、秋の風情を満喫できます。",
        content: "市内屈指の紅葉スポット○○公園で、恒例の「紅葉まつり2024」が10月15日から11月15日まで開催される。約500本のモミジやイチョウが色づく園内では、日中の紅葉散策に加えて、17:00-21:00の夜間ライトアップも実施される。期間中は地元グルメの屋台村が設置され、焼きそば、たこ焼き、地元産の栗や芋を使ったスイーツなど約20店舗が出店予定。また、週末には地元の太鼓グループや民謡サークルによるステージイベントも開催される。入園料は平日300円、土日祝日500円（中学生以下無料）。昨年は約8万人が来場した人気イベントで、今年はさらなる来場者増が見込まれている。",
        image: "https://images.unsplash.com/photo-1518005020951-eccb494ad742?w=400&h=250&fit=crop&q=80",
        category: "events",
        region: "tokyo",
        source: "東京イベント情報",
        publishedAt: "2024-09-01T10:15:00",
        isBreaking: false,
        tags: ["イベント", "紅葉", "祭り"]
    },
    {
        id: "26",
        title: "花火大会の打ち上げ場所が新エリアに変更、見やすさ向上",
        excerpt: "来年夏の花火大会で、打ち上げ場所が従来より広い新エリアに変更されることが発表されました。観覧エリアも拡大され、より多くの人が楽しめます。",
        content: "来年8月開催予定の「○○花火大会」の実行委員会は、花火の打ち上げ場所を川の中州から対岸の新エリアに変更すると発表した。新しい打ち上げ場所は従来の約2倍の面積があり、より大型で迫力のある花火の打ち上げが可能となる。これに伴い観覧エリアも拡大され、収容人数は従来の約3万人から5万人に増加する予定。新たに設けられる有料観覧席（一般席3,000円、カップル席5,000円）では、ゆっくりと花火を楽しめる環境を提供する。実行委員長は「より多くの方に安全で快適に花火を楽しんでもらいたい」とコメント。来年3月から観覧席の予約受付を開始する予定。",
        image: "https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=250&fit=crop&q=80",
        category: "events",
        region: "kanagawa",
        source: "神奈川花火協会",
        publishedAt: "2024-08-31T18:00:00",
        isBreaking: false,
        tags: ["イベント", "花火大会", "変更"]
    },
    {
        id: "27",
        title: "地域の音楽フェスティバルに有名アーティストが参加決定",
        excerpt: "地域密着型の音楽フェスティバルに、全国的に活動する有名アーティストの参加が決定。地元アーティストとのコラボレーションも予定されています。",
        content: "11月3日開催の地域音楽フェスティバル「○○ミュージックフェス」に、全国的に活動するロックバンド「◇◇」の参加が正式決定した。同バンドは今年リリースしたアルバムがオリコンチャート1位を獲得するなど、現在最も注目されているアーティストの一人。フェスでは地元出身のシンガーソングライター3組とのスペシャルコラボレーションも予定されており、ここでしか聴けない特別な楽曲が披露される。会場は市内中央公園の野外ステージで、チケットは前売り4,500円、当日5,000円。地元の飲食店による屋台エリアも充実し、音楽と食を同時に楽しめる。昨年は約1万人が来場し、今年はさらなる盛り上がりが期待される。",
        image: "https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=400&h=250&fit=crop&q=80",
        category: "events",
        region: "osaka",
        source: "大阪音楽情報",
        publishedAt: "2024-08-31T15:30:00",
        isBreaking: false,
        tags: ["イベント", "音楽", "フェスティバル"]
    },
    {
        id: "28",
        title: "伝統的な夏祭りが4年ぶりに完全復活、神輿渡御も再開",
        excerpt: "コロナ禍で縮小開催が続いていた伝統的な夏祭りが、来年は4年ぶりに完全な形で復活します。神輿渡御や露店も例年通り実施される予定です。",
        content: "300年の歴史を持つ「○○夏祭り」が、来年は4年ぶりに完全な形で復活することが祭り実行委員会から発表された。コロナ禍の影響で2020年は中止、2021-2023年は規模を大幅に縮小して開催されていたが、来年7月20-22日の3日間は従来通りの盛大な祭りとなる。メインイベントである神輿渡御では、重さ1トンを超える本神輿を約200人で担ぎ、商店街や住宅街を練り歩く。また、約100店舗の露店も復活し、金魚すくいや射的などの伝統的な縁日ゲームも楽しめる。実行委員長は「地域の絆を再確認し、伝統を次世代に継承する重要な機会」と語る。参加者募集は来年4月から開始予定。",
        image: "https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=400&h=250&fit=crop&q=80",
        category: "events",
        region: "kyoto",
        source: "京都祭り情報",
        publishedAt: "2024-08-30T20:45:00",
        isBreaking: false,
        tags: ["イベント", "夏祭り", "復活"]
    },
    {
        id: "29",
        title: "アート展示と地元野菜の収穫体験を組み合わせた新イベント",
        excerpt: "現代アート展示と農業体験を融合させた新しいイベントが企画されています。アートを鑑賞した後に畑で野菜収穫を楽しめるユニークな体験です。",
        content: "地域の芸術家集団と農家グループがコラボレーションした新イベント「アート＆ハーベスト」が10月28-29日に開催される。このイベントは午前中に地元アーティスト20名の作品展示を楽しみ、午後は隣接する農園で季節野菜の収穫体験を行うという斬新な企画。参加者は現代絵画や彫刻作品を鑑賞した後、大根、人参、白菜などの秋野菜を実際に収穫し、持ち帰ることができる。さらに収穫した野菜を使った料理教室も開催され、アートと食の両方を満喫できる。参加費は大人2,800円、子供1,500円（野菜お土産付き）。定員各日50名の完全予約制で、既に半数以上の予約が入っているという。都市と農村の新しい交流の形として注目されている。",
        image: "https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?w=400&h=250&fit=crop&q=80",
        category: "events",
        region: "saitama",
        source: "埼玉アート情報",
        publishedAt: "2024-08-30T13:20:00",
        isBreaking: false,
        tags: ["イベント", "アート", "農業体験"]
    },
    // 宿泊・温泉記事
    {
        id: "30",
        title: "山間の老舗温泉旅館がリニューアル、露天風呂を新設",
        excerpt: "創業120年の歴史を持つ温泉旅館が大規模リニューアルを完了。新たに設けられた露天風呂からは四季折々の渓谷美を楽しめます。",
        content: "山間に位置する老舗温泉旅館「○○館」が約2年間の大規模リニューアル工事を完了し、新装開業した。創業120年の歴史を持つ同旅館は、伝統的な和の趣はそのままに、客室や館内設備を全面的に刷新。最大の目玉は新設された渓谷沿いの露天風呂で、春は桜、夏は新緑、秋は紅葉、冬は雪景色と四季折々の美しい景色を楽しみながら温泉に浸かることができる。客室は全20室から15室に集約し、一室あたりの面積を拡大。すべての客室に檜の内湯も完備した。料金は1泊2食付きで25,000円から。女将の田中さんは「多くのお客様に愛され続けてきた温泉の魅力をさらに高め、心に残る滞在を提供したい」と話している。",
        image: "https://images.unsplash.com/photo-1518005020951-eccb494ad742?w=400&h=250&fit=crop&q=80",
        category: "accommodation",
        region: "kanagawa",
        source: "神奈川温泉協会",
        publishedAt: "2024-09-01T11:45:00",
        isBreaking: false,
        tags: ["宿泊", "温泉", "リニューアル"]
    },
    {
        id: "31",
        title: "駅直結の新ホテルがオープン、アクセス抜群で観光に便利",
        excerpt: "市の玄関口である駅に直結した新しいビジネスホテルがオープン。観光地へのアクセスが良く、リーズナブルな価格で宿泊できます。",
        content: "市内中心部のターミナル駅に直結する新ホテル「○○ステーションホテル」がグランドオープンした。地上12階建てで全160室を擁するビジネスホテルで、駅から徒歩0分という抜群のアクセスを誇る。客室はシングル、ツイン、ダブルの3タイプで、シンプルで機能的な内装が特徴。全室にWi-Fi、空気清浄機、大型テレビを完備し、快適な滞在をサポートする。料金はシングル6,800円から、ツイン9,800円からとリーズナブル。1階にはコンビニとカフェ、最上階には市街地を一望できる展望レストランも併設。ホテル支配人は「観光やビジネスの拠点として、多くの方にご利用いただきたい」とコメント。開業から1ヶ月で稼働率85%を記録している。",
        image: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=250&fit=crop&q=80",
        category: "accommodation",
        region: "tokyo",
        source: "東京宿泊情報",
        publishedAt: "2024-08-31T09:30:00",
        isBreaking: false,
        tags: ["宿泊", "ホテル", "新規開業"]
    },
    // 交通・アクセス記事
    {
        id: "32",
        title: "観光地巡りバス路線が新設、主要スポットを効率的に周遊",
        excerpt: "市内の主要観光スポットを結ぶ新しいバス路線が開設されます。1日乗車券で効率よく観光地を巡ることができ、観光客の利便性が大幅に向上します。",
        content: "市内の主要観光地15箇所を結ぶ新バス路線「観光周遊ライン」が10月1日から運行開始される。このバス路線は市内中心部を起点に、美術館、寺院、公園、ショッピングエリアなどを約45分で一周するルートで設計されている。平日は30分間隔、土日祝日は20分間隔で運行し、朝8時から夜7時まで利用可能。1日乗車券は大人600円、子供300円で、各観光施設での割引特典も付いている。バス車内では日本語、英語、中国語、韓国語での観光案内アナウンスも実施。市観光課では「公共交通を使った持続可能な観光を推進したい」と説明している。運行開始前の試乗会では、参加者から「これで車がなくても安心して観光できる」との好評価を得ている。",
        image: "https://images.unsplash.com/photo-1495020689067-958852a7765e?w=400&h=250&fit=crop&q=80",
        category: "transport",
        region: "kyoto",
        source: "京都交通局",
        publishedAt: "2024-09-01T14:15:00",
        isBreaking: false,
        tags: ["交通", "バス", "観光"]
    },
    // 天気・防災記事  
    {
        id: "33",
        title: "観光シーズンの防災対策強化、避難場所の案内板を多言語化",
        excerpt: "観光客の安全確保のため、主要観光地の避難場所案内板が多言語対応になりました。緊急時の情報提供体制も強化され、安心して観光を楽しめます。",
        content: "市内の主要観光地20箇所で、緊急時の避難場所を示す案内板の多言語化が完了した。これまで日本語のみだった案内板に、英語、中国語、韓国語、タイ語の表記を追加し、外国人観光客の安全確保を図る。新しい案内板には避難場所への距離と所要時間も明記され、QRコードを読み取ることで災害時の詳細な避難手順を確認することもできる。また、市の防災アプリも多言語対応を行い、緊急警報や避難指示をリアルタイムで配信するシステムを構築した。市防災課長は「年間300万人の観光客を迎える当市として、すべての来訪者の安全を守ることが責務」と語る。今後は観光案内所での防災グッズの配布や、ホテル・旅館と連携した避難訓練の実施も検討している。",
        image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=250&fit=crop&q=80",
        category: "weather",
        region: "osaka",
        source: "大阪市防災局",
        publishedAt: "2024-08-30T16:00:00",
        isBreaking: false,
        tags: ["防災", "多言語", "観光客"],
        originalUrl: "https://example.com/news/multilingual-disaster-signs"
    },
    {
        id: "34",
        title: "札幌市内で新たな雪まつり関連イベントを企画",
        excerpt: "来年の雪まつりに向けて、地域住民参加型の雪像制作ワークショップや、北海道グルメフェスティバルが開催予定。",
        content: "札幌市は来年2月開催予定の雪まつりで、新たな地域密着型イベントを展開すると発表した。今回初の試みとして、一般市民が参加できる雪像制作ワークショップを12月から開始。専門の雪像師が指導し、小さな雪像作りから始めて、最終的には実際の雪まつり会場に展示される作品を制作する。また、期間中は「北海道まるごとグルメフェスティバル」も同時開催し、道内全179市町村の特産品を味わえるブースを設置。ジンギスカン、スープカレー、海鮮丼など定番グルメから、各地域の隠れた名物まで約500品目が集結する予定。実行委員会では「観光客だけでなく、道民にも北海道の魅力を再発見してもらいたい」と期待を寄せている。",
        image: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=250&fit=crop&q=80",
        category: "events",
        region: "hokkaido",
        source: "札幌市観光局",
        publishedAt: "2024-09-02T10:15:00",
        isBreaking: false,
        tags: ["雪まつり", "ワークショップ", "グルメ"],
        originalUrl: "https://example.com/news/sapporo-snow-festival-2025"
    },
    {
        id: "35",
        title: "沖縄・石垣島で新種のサンゴ礁発見、エコツアー開始",
        excerpt: "石垣島周辺で新種のサンゴが発見され、海洋生物保護とエコツーリズムを両立した新しい観光プログラムが開始されました。",
        content: "石垣島周辺の海域で新種のサンゴ礁が発見され、これを活用したエコツーリズムプログラム「サンゴ礁保護体験ツアー」が開始された。琉球大学海洋生物研究所と地元ダイビング業者が共同で企画したこのツアーでは、参加者が研究者と一緒にサンゴ礁の観察・記録を行い、海洋環境保護について学ぶことができる。新種のサンゴは従来種より高い水温耐性を持つことが判明しており、地球温暖化に対するサンゴ礁の適応メカニズム研究に重要な手がかりを提供している。ツアー参加者は専用の防水カメラでサンゴの撮影を行い、データは研究機関に提供される。地元の漁業協同組合も協力し、持続可能な海洋資源利用について解説。参加費の一部は海洋保護基金に寄付される仕組みとなっている。",
        image: "https://images.unsplash.com/photo-1582967788606-a171c1080cb0?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "okinawa", 
        source: "石垣市観光協会",
        publishedAt: "2024-09-01T14:20:00",
        isBreaking: false,
        tags: ["エコツーリズム", "サンゴ礁", "環境保護"],
        originalUrl: "https://example.com/news/ishigaki-coral-discovery"
    },
    {
        id: "36",
        title: "京都・嵐山で竹林ライトアップ、夜間特別拝観開始",
        excerpt: "嵐山の竹林が期間限定で夜間ライトアップされ、幻想的な景色を楽しめる特別拝観が開始されました。",
        content: "京都・嵐山の竹林で、秋の夜間特別ライトアップが9月15日から11月30日まで実施される。約400メートルの竹林の小径に、LED照明を使った演出を施し、青白い光が竹の隙間から差し込む幻想的な空間を演出。時間は午後6時から9時まで、入場料は大人800円。今年は新たに音響演出も加わり、竹の揺れる音や虫の声などの自然音をBGMとして流す。また、途中3箇所に休憩スペースを設け、地元茶店が監修した竹炭入り抹茶や竹筒入り甘酒の販売も行う。京都市観光協会によると「昼間とは全く違う竹林の美しさを体験でき、写真愛好家からも高い評価を得ている」とのこと。期間中は平日でも混雑が予想されるため、事前予約制を導入。公式サイトまたは現地での当日券販売となる。",
        image: "https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=400&h=250&fit=crop&q=80",
        category: "tourism",
        region: "kyoto",
        source: "京都市観光協会", 
        publishedAt: "2024-09-01T16:45:00",
        isBreaking: false,
        tags: ["ライトアップ", "竹林", "夜間拝観"],
        originalUrl: "https://example.com/news/arashiyama-bamboo-lightup"
    },
    {
        id: "37",
        title: "広島・宮島で厳島神社の大鳥居修復工事が完了",
        excerpt: "約3年にわたる大規模修復工事が完了し、宮島のシンボル・厳島神社の大鳥居が美しい姿を取り戻しました。",
        content: "広島県廿日市市の宮島にある厳島神社の大鳥居の大規模修復工事が完了し、9月1日から一般公開が再開された。2021年6月から約3年2ヵ月をかけて行われた今回の修復では、主柱の腐食部分の交換、屋根の檜皮葺き替え、朱塗りの全面塗り直しなどが実施された。使用された檜材は樹齢300年以上の吉野杉を使用し、伝統的な宮大工の技術で組み上げられた。総工費は約25億円。修復を記念して、10月には「大鳥居復活祭」を開催予定で、雅楽の演奏や地元産品の販売、夜間の特別ライトアップなどが企画されている。宮島観光協会では「世界遺産の威厳ある姿を次世代に継承できた。国内外から多くの方に新しい大鳥居を見に来ていただきたい」とコメント。干潮時には鳥居の根元まで歩いて見学することが可能で、修復の技術についての解説パネルも設置されている。",
        image: "https://images.unsplash.com/photo-1490806843957-31f4c9a91c65?w=400&h=250&fit=crop&q=80",
        category: "culture",
        region: "hiroshima",
        source: "宮島観光協会",
        publishedAt: "2024-09-01T09:30:00", 
        isBreaking: false,
        tags: ["世界遺産", "修復", "伝統文化"],
        originalUrl: "https://example.com/news/itsukushima-torii-restoration"
    },
    {
        id: "38",
        title: "金沢・兼六園で新たな茶室「雪見亭」がオープン",
        excerpt: "兼六園内に江戸時代の建築様式を再現した新しい茶室がオープン。伝統的な茶道体験と加賀料理が楽しめます。",
        content: "金沢市の特別名勝・兼六園内に、新しい茶室「雪見亭」が9月3日にオープンする。この茶室は江戸時代後期の加賀藩の茶室建築を忠実に再現したもので、約2年の歳月をかけて建設された。建物には能登産の珪藻土、白山麓の杉材、輪島塗の建具など、石川県産の伝統素材をふんだんに使用。内部は8畳と4畳半の二間構成で、雪吊りで有名な兼六園の冬景色を眺められる絶好のロケーション。茶道体験（3,500円）では、表千家の作法で抹茶を点て、地元和菓子店「森八」の上生菓子と合わせて味わえる。また、加賀料理のコース（8,800円）も提供し、治部煮、鴨の治部煮、加賀野菜を使った精進料理など、金沢の食文化を堪能できる。茶室からは霞ヶ池越しに雪吊りされた松の美しい姿を一望でき、四季折々の庭園美を楽しめる。完全予約制で、一日最大20組まで。",
        image: "https://images.unsplash.com/photo-1508672019048-805c876b67e2?w=400&h=250&fit=crop&q=80",
        category: "culture",
        region: "ishikawa",
        source: "金沢市観光協会",
        publishedAt: "2024-09-02T11:00:00",
        isBreaking: false,
        tags: ["茶道", "兼六園", "加賀料理"],
        originalUrl: "https://example.com/news/kenrokuen-yukimi-tei"
    }
];

// DOM要素の取得
const searchInput = document.getElementById('searchInput');
const regionSelect = document.getElementById('regionSelect');
const categoryTabs = document.getElementById('categoryTabs');
const topNewsContainer = document.getElementById('topNews');
const breakingNewsContainer = document.getElementById('breakingNews');
const newsGridContainer = document.getElementById('newsGrid');
const loadingOverlay = document.getElementById('loadingOverlay');
const newsModal = document.getElementById('newsModal');

// ニュースAPI設定
const NEWS_API_CONFIG = {
    // NewsAPI (要API キー)
    newsApi: {
        baseUrl: 'https://newsapi.org/v2',
        apiKey: '', // 実際のAPIキーに置き換えてください
        endpoints: {
            topHeadlines: '/top-headlines',
            everything: '/everything'
        }
    },
    // 地域ニュース・観光情報 RSS
    rssFeeds: [
        // 全国ニュース
        {
            name: 'Yahoo! ニュース - トップ',
            url: 'https://news.yahoo.co.jp/rss/topics/top-picks.xml',
            category: 'breaking'
        },
        {
            name: 'Yahoo! ニュース - 国内',
            url: 'https://news.yahoo.co.jp/rss/topics/domestic.xml', 
            category: 'breaking'
        },
        {
            name: 'NHK ニュース',
            url: 'https://www3.nhk.or.jp/rss/news/cat0.xml',
            category: 'breaking'
        },
        
        // 地域ニュース
        {
            name: '朝日新聞 - 地域',
            url: 'https://www.asahi.com/rss/area.xml',
            category: 'tourism'
        },
        {
            name: '読売新聞 - 地域',
            url: 'https://www.yomiuri.co.jp/local/rss',
            category: 'all'
        },
        
        // 東京・首都圏
        {
            name: '東京都 - お知らせ',
            url: 'https://www.metro.tokyo.lg.jp/rss/new.xml',
            category: 'all'
        },
        {
            name: '東京観光財団',
            url: 'https://www.gotokyo.org/rss/ja/news.xml',
            category: 'tourism'
        },
        
        // 大阪・関西
        {
            name: '大阪府 - 報道発表',
            url: 'https://www.pref.osaka.lg.jp/koho/rss/press.xml',
            category: 'all'
        },
        {
            name: '大阪観光局',
            url: 'https://www.osaka-info.jp/rss/news.xml',
            category: 'tourism'
        },
        
        // 愛知・中部
        {
            name: '愛知県 - 新着情報',
            url: 'https://www.pref.aichi.jp/rss/press.xml',
            category: 'all'
        },
        
        // 福岡・九州
        {
            name: '福岡県 - 報道発表',
            url: 'https://www.pref.fukuoka.lg.jp/rss/press.xml',
            category: 'all'
        },
        
        // 観光・イベント情報
        {
            name: 'じゃらんニュース',
            url: 'https://www.jalan.net/news/rss.xml',
            category: 'tourism'
        },
        {
            name: '楽天トラベル ニュース',
            url: 'https://travel.rakuten.co.jp/news/rss.xml',
            category: 'tourism'
        },
        {
            name: 'ぐるなび - グルメ情報',
            url: 'https://www.gnavi.co.jp/news/rss.xml',
            category: 'gourmet'
        },
        
        // 文化・イベント
        {
            name: '文化庁 - 報道発表',
            url: 'https://www.bunka.go.jp/rss/press.xml',
            category: 'culture'
        },
        {
            name: 'イベントバンク',
            url: 'https://www.eventbank.jp/rss/event.xml',
            category: 'events'
        },
        
        // 交通・天気
        {
            name: '気象庁 - 気象情報',
            url: 'https://www.jma.go.jp/bosai/rss/regular.xml',
            category: 'weather'
        },
        {
            name: 'JR東日本 - 運行情報',
            url: 'https://www.jreast.co.jp/rss/press.xml',
            category: 'transport'
        },
        
        // 地方紙・地域情報
        {
            name: '神奈川新聞',
            url: 'https://www.kanaloco.jp/rss/news.xml',
            category: 'all'
        },
        {
            name: '京都新聞',
            url: 'https://www.kyoto-np.co.jp/rss/news.xml',
            category: 'all'
        },
        {
            name: '北海道新聞',
            url: 'https://www.hokkaido-np.co.jp/rss/news.xml',
            category: 'all'
        },
        {
            name: '沖縄タイムス',
            url: 'https://www.okinawatimes.co.jp/rss/news.xml',
            category: 'all'
        }
    ],
    // 画像検索設定
    imageSearch: {
        unsplashAccessKey: '', // Unsplash API キー（無料）
        pixabayApiKey: '', // Pixabay API キー（無料）
        fallbackImages: {
            'tourism': 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=250&fit=crop',
            'breaking': 'https://images.unsplash.com/photo-1495020689067-958852a7765e?w=400&h=250&fit=crop',
            'gourmet': 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=250&fit=crop',
            'events': 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&h=250&fit=crop',
            'culture': 'https://images.unsplash.com/photo-1518005020951-eccb494ad742?w=400&h=250&fit=crop',
            'shopping': 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=250&fit=crop',
            'accommodation': 'https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=400&h=250&fit=crop',
            'transport': 'https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=400&h=250&fit=crop',
            'weather': 'https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?w=400&h=250&fit=crop'
        }
    }
};

// 現在のフィルター状態
let currentFilters = {
    category: 'all',
    region: 'all',
    search: ''
};

// ニュースデータのキャッシュ
let newsCache = {
    data: [],
    lastFetch: null,
    expireTime: 10 * 60 * 1000 // 10分
};

// 画像キャッシュ
let imageCache = new Map();

// Intersection Observer for lazy loading
let imageObserver = null;

// 外部ニュース取得関数
async function fetchExternalNews() {
    try {
        showLoading();
        
        // キャッシュチェック
        const now = new Date().getTime();
        if (newsCache.lastFetch && (now - newsCache.lastFetch) < newsCache.expireTime) {
            console.log('キャッシュからニュースデータを取得');
            return newsCache.data;
        }
        
        const allNews = [];
        
        // RSS フィードから取得（CORS対応のため、プロキシサーバーまたは直接取得を試行）
        for (const feed of NEWS_API_CONFIG.rssFeeds) {
            try {
                const rssNews = await fetchRSSFeed(feed);
                allNews.push(...rssNews);
            } catch (error) {
                console.warn(`RSSフィード取得エラー (${feed.name}):`, error);
            }
        }
        
        // NewsAPI から取得（APIキーが設定されている場合）
        if (NEWS_API_CONFIG.newsApi.apiKey) {
            try {
                const apiNews = await fetchNewsAPI();
                allNews.push(...apiNews);
            } catch (error) {
                console.warn('NewsAPI取得エラー:', error);
            }
        }
        
        // 外部データが取得できない場合はエラーとする
        if (allNews.length === 0) {
            console.warn('外部ニュースが取得できませんでした');
            throw new Error('実際のニュース記事を取得できませんでした');
        }
        
        // データを整理してキャッシュに保存
        const processedNews = await processNewsData(allNews);
        newsCache.data = processedNews;
        newsCache.lastFetch = now;
        
        return processedNews;
        
    } catch (error) {
        console.error('ニュース取得エラー:', error);
        // エラー時は空配列を返す
        return [];
    } finally {
        hideLoading();
    }
}

// 記事の全文取得関数
async function fetchFullArticleContent(article) {
    if (!article.originalUrl) return article.content || article.excerpt;
    
    try {
        // まずキャッシュをチェック
        const cacheKey = `content_${article.id}`;
        if (imageCache.has(cacheKey)) {
            return imageCache.get(cacheKey);
        }
        
        // 記事の内容を取得する複数の方法を試行
        const content = await tryMultipleContentExtractors(article.originalUrl, article);
        
        if (content && content.length > 100) {
            imageCache.set(cacheKey, content);
            return content;
        }
        
        return article.content || article.excerpt || '記事の詳細を確認するには、元記事のリンクをご利用ください。';
        
    } catch (error) {
        console.warn('記事内容取得エラー:', error);
        return article.content || article.excerpt || '記事の詳細を確認するには、元記事のリンクをご利用ください。';
    }
}

// 複数のコンテンツ抽出手法を試行
async function tryMultipleContentExtractors(url, article) {
    const extractors = [
        () => extractWithAllOrigins(url),
        () => extractWithProxy(url),
        () => generateContentFromSummary(article)
    ];
    
    for (const extractor of extractors) {
        try {
            const content = await extractor();
            if (content && content.length > 100) {
                return content;
            }
        } catch (error) {
            console.warn('コンテンツ抽出手法エラー:', error);
            continue;
        }
    }
    
    return null;
}

// AllOrigins プロキシを使用した記事取得
async function extractWithAllOrigins(url) {
    try {
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
        const response = await fetch(proxyUrl);
        const data = await response.json();
        
        if (data.contents) {
            return extractMainContentFromHTML(data.contents, url);
        }
    } catch (error) {
        console.warn('AllOrigins エラー:', error);
    }
    return null;
}

// 他のプロキシサービスを試行
async function extractWithProxy(url) {
    const proxies = [
        `https://corsproxy.io/?${encodeURIComponent(url)}`,
        `https://cors-anywhere.herokuapp.com/${url}`,
        `https://thingproxy.freeboard.io/fetch/${url}`
    ];
    
    for (const proxyUrl of proxies) {
        try {
            const response = await fetch(proxyUrl);
            if (response.ok) {
                const html = await response.text();
                return extractMainContentFromHTML(html, url);
            }
        } catch (error) {
            continue;
        }
    }
    return null;
}

// HTMLから主要コンテンツを抽出
function extractMainContentFromHTML(html, originalUrl) {
    try {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Yahoo!ニュース固有の抽出
        if (originalUrl.includes('yahoo.co.jp')) {
            return extractYahooNewsContent(doc);
        }
        
        // NHKニュース固有の抽出
        if (originalUrl.includes('nhk.or.jp')) {
            return extractNHKNewsContent(doc);
        }
        
        // 一般的な記事抽出
        return extractGenericNewsContent(doc);
        
    } catch (error) {
        console.error('HTML解析エラー:', error);
        return null;
    }
}

// URLから記事画像を抽出
async function extractImageFromURL(url) {
    try {
        // CORS制限を回避するプロキシサービスを使用
        const proxies = [
            `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
            `https://cors-anywhere.herokuapp.com/${url}`
        ];
        
        for (const proxyUrl of proxies) {
            try {
                const response = await fetch(proxyUrl);
                if (response.ok) {
                    const data = await response.json();
                    const html = data.contents || data;
                    return extractImageFromHTML(html, url);
                }
            } catch (error) {
                continue;
            }
        }
        return null;
    } catch (error) {
        console.error('URL画像抽出エラー:', error);
        return null;
    }
}

// HTMLから画像を抽出
function extractImageFromHTML(html, originalUrl) {
    try {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // メタタグのog:imageを優先
        const ogImage = doc.querySelector('meta[property="og:image"]');
        if (ogImage) {
            const imageUrl = ogImage.getAttribute('content');
            if (imageUrl && isValidImageUrl(imageUrl)) {
                return makeAbsoluteUrl(imageUrl, originalUrl);
            }
        }
        
        // Twitter Cardの画像
        const twitterImage = doc.querySelector('meta[name="twitter:image"]');
        if (twitterImage) {
            const imageUrl = twitterImage.getAttribute('content');
            if (imageUrl && isValidImageUrl(imageUrl)) {
                return makeAbsoluteUrl(imageUrl, originalUrl);
            }
        }
        
        // 記事内の最初の画像
        const articleImg = doc.querySelector('article img, .article img, .content img, .post img');
        if (articleImg) {
            const imageUrl = articleImg.getAttribute('src');
            if (imageUrl && isValidImageUrl(imageUrl)) {
                return makeAbsoluteUrl(imageUrl, originalUrl);
            }
        }
        
        // 一般的なimgタグから検索
        const images = doc.querySelectorAll('img');
        for (const img of images) {
            const src = img.getAttribute('src');
            if (src && isValidImageUrl(src) && !src.includes('logo') && !src.includes('avatar')) {
                const width = img.getAttribute('width') || img.naturalWidth || 0;
                const height = img.getAttribute('height') || img.naturalHeight || 0;
                
                // ある程度大きな画像のみ取得（小さなアイコンなどを除外）
                if (width >= 200 || height >= 150) {
                    return makeAbsoluteUrl(src, originalUrl);
                }
            }
        }
        
        return null;
    } catch (error) {
        console.error('HTML画像解析エラー:', error);
        return null;
    }
}

// 相対URLを絶対URLに変換
function makeAbsoluteUrl(url, baseUrl) {
    if (url.startsWith('http')) {
        return url;
    }
    
    try {
        const base = new URL(baseUrl);
        return new URL(url, base).toString();
    } catch (error) {
        return url;
    }
}

// Yahoo!ニュース用コンテンツ抽出
function extractYahooNewsContent(doc) {
    const selectors = [
        '.sc-gKsewC.eCJdCh .sc-eHgmQL.ixWCJX p', // Yahoo!の記事本文
        '.sc-fznyAO .sc-eHgmQL p',
        '[data-ylk*="main"] p',
        '.articleText p',
        '.ynDetailText p',
        'article p',
        '.content p'
    ];
    
    for (const selector of selectors) {
        const elements = doc.querySelectorAll(selector);
        if (elements.length > 0) {
            const content = Array.from(elements)
                .map(p => p.textContent.trim())
                .filter(text => text.length > 20)
                .join('\n\n');
            
            if (content.length > 100) {
                return content;
            }
        }
    }
    return null;
}

// NHKニュース用コンテンツ抽出
function extractNHKNewsContent(doc) {
    const selectors = [
        '.content--detail-main p',
        '.content--detail-body p',
        '.body-text p',
        'article .content p',
        '.article-main p'
    ];
    
    for (const selector of selectors) {
        const elements = doc.querySelectorAll(selector);
        if (elements.length > 0) {
            const content = Array.from(elements)
                .map(p => p.textContent.trim())
                .filter(text => text.length > 20)
                .join('\n\n');
            
            if (content.length > 100) {
                return content;
            }
        }
    }
    return null;
}

// 一般的なニュースサイト用コンテンツ抽出
function extractGenericNewsContent(doc) {
    const selectors = [
        'article p',
        '.article-body p',
        '.content p',
        '.post-content p',
        '.entry-content p',
        'main p',
        '.story-body p'
    ];
    
    for (const selector of selectors) {
        const elements = doc.querySelectorAll(selector);
        if (elements.length > 2) {
            const content = Array.from(elements)
                .map(p => p.textContent.trim())
                .filter(text => text.length > 20)
                .slice(0, 10) // 最大10段落まで
                .join('\n\n');
            
            if (content.length > 100) {
                return content;
            }
        }
    }
    return null;
}

// サマリーから擬似的なコンテンツを生成
function generateContentFromSummary(article) {
    if (!article.excerpt || article.excerpt.length < 50) return null;
    
    // RSSの説明からより詳細な情報を抽出
    let content = article.excerpt;
    
    // HTMLタグが含まれている場合は除去して使用
    if (content.includes('<')) {
        content = stripHTML(content);
    }
    
    // より詳しい疑似記事を生成
    const sections = [
        content,
        '',
        `【詳細】`,
        `この記事は${article.source}から配信され、${formatDate(article.publishedAt)}に公開されました。`,
        '',
        `記事のカテゴリは「${getCategoryName(article.category)}」に分類されており、地域に関連した重要な情報が含まれています。`,
        '',
        `【関連情報】`,
        article.tags.length > 0 ? `関連キーワード: ${article.tags.join(', ')}` : '詳細な関連情報については元記事をご確認ください。',
        '',
        `【元記事について】`,
        `より詳しい内容や最新の更新については、下記の「元記事を見る」ボタンから公式サイトでご確認いただけます。`
    ];
    
    return sections.join('\n');
}

// 改良版RSS内容抽出
function extractEnhancedRSSContent(description, title) {
    if (!description) return null;
    
    let content = stripHTML(description);
    
    // 短すぎる場合は拡張
    if (content.length < 200) {
        content += `\n\n【記事概要】\n${title}について詳しく報じられています。`;
        
        // タイトルからキーワードを推測して内容を補強
        const keywords = extractImageKeywords(title + ' ' + content);
        if (keywords.length > 0) {
            content += `\n\nこの記事では、${keywords.slice(0, 3).join('、')}に関連した内容が取り上げられています。`;
        }
        
        content += `\n\n最新の詳細情報については、元記事をご覧ください。`;
    }
    
    return content;
}

// RSS フィード取得関数
async function fetchRSSFeed(feed) {
    try {
        // CORS対応のため、公開プロキシサービスを使用
        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(feed.url)}`;
        const response = await fetch(proxyUrl);
        const xmlText = await response.text();
        
        return parseRSSFeed(xmlText, feed);
    } catch (error) {
        console.error(`RSS取得エラー (${feed.name}):`, error);
        return [];
    }
}

// RSS XMLパース関数
async function parseRSSFeed(xmlText, feedConfig) {
    try {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
        const items = xmlDoc.querySelectorAll('item');
        
        const news = [];
        const promises = [];
        
        items.forEach((item, index) => {
            if (index >= 50) return; // 最大50件まで
            
            const title = item.querySelector('title')?.textContent?.trim();
            const link = item.querySelector('link')?.textContent?.trim();
            const description = item.querySelector('description')?.textContent?.trim();
            const pubDate = item.querySelector('pubDate')?.textContent?.trim();
            
            if (title && link) {
                const category = mapCategoryFromFeed(feedConfig.category);
                
                // 画像を抽出または検索
                const promise = extractImageFromRSS(item, title, description, category).then(imageUrl => {
                    // より詳細なコンテンツを生成
                    const enhancedContent = extractEnhancedRSSContent(description, title);
                    const excerpt = description ? stripHTML(description).substring(0, 200) + '...' : '記事の詳細を確認してください。';
                    
                    return {
                        id: `rss_${feedConfig.name}_${index}_${Date.now()}`,
                        title: title,
                        excerpt: excerpt,
                        content: enhancedContent || description || '',
                        image: imageUrl,
                        category: category,
                        region: 'all',
                        source: feedConfig.name,
                        publishedAt: pubDate ? new Date(pubDate).toISOString() : new Date().toISOString(),
                        isBreaking: feedConfig.category === 'breaking',
                        tags: extractTags(title + ' ' + (description || '')),
                        originalUrl: link
                    };
                });
                
                promises.push(promise);
            }
        });
        
        const results = await Promise.all(promises);
        return results;
        
    } catch (error) {
        console.error('RSSパースエラー:', error);
        return [];
    }
}

// RSS記事から画像を抽出
async function extractImageFromRSS(item, title, description, category) {
    try {
        // 1. RSS内の画像タグを検索
        const mediaContent = item.querySelector('media\\:content, content');
        if (mediaContent) {
            const imageUrl = mediaContent.getAttribute('url');
            if (imageUrl && isValidImageUrl(imageUrl)) {
                return imageUrl;
            }
        }
        
        // 2. enclosureタグを検索
        const enclosure = item.querySelector('enclosure[type^="image"]');
        if (enclosure) {
            const imageUrl = enclosure.getAttribute('url');
            if (imageUrl && isValidImageUrl(imageUrl)) {
                return imageUrl;
            }
        }
        
        // 3. description内のimgタグを検索
        if (description) {
            const imgRegex = /<img[^>]+src=['"]([^'"]+)['"]/i;
            const match = description.match(imgRegex);
            if (match && isValidImageUrl(match[1])) {
                return match[1];
            }
        }
        
        // 4. 関連画像を検索
        const relevantImage = await getRelevantImage(title, description, category);
        return relevantImage;
        
    } catch (error) {
        console.error('画像抽出エラー:', error);
        return getRelevantImage(title, description, category);
    }
}

// 有効な画像URLかチェック
function isValidImageUrl(url) {
    if (!url) return false;
    
    const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg'];
    const lowerUrl = url.toLowerCase();
    
    return imageExtensions.some(ext => lowerUrl.includes(ext)) || 
           lowerUrl.includes('images.') || 
           lowerUrl.includes('/photo/') ||
           lowerUrl.includes('unsplash.com') ||
           lowerUrl.includes('pixabay.com');
}

// NewsAPI取得関数
async function fetchNewsAPI() {
    try {
        const url = `${NEWS_API_CONFIG.newsApi.baseUrl}${NEWS_API_CONFIG.newsApi.endpoints.topHeadlines}?country=jp&apiKey=${NEWS_API_CONFIG.newsApi.apiKey}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.status === 'ok') {
            const promises = data.articles.map(async (article, index) => {
                let imageUrl = article.urlToImage;
                
                // 画像がない場合は関連画像を検索
                if (!imageUrl || !isValidImageUrl(imageUrl)) {
                    imageUrl = await getRelevantImage(article.title, article.description, 'breaking');
                }
                
                return {
                    id: `api_${index}_${Date.now()}`,
                    title: article.title,
                    excerpt: article.description || '記事の詳細を確認してください。',
                    content: article.content || article.description || '',
                    image: imageUrl,
                    category: 'breaking',
                    region: 'all',
                    source: article.source.name,
                    publishedAt: article.publishedAt,
                    isBreaking: true,
                    tags: extractTags(article.title + ' ' + (article.description || '')),
                    originalUrl: article.url
                };
            });
            
            return await Promise.all(promises);
        }
        return [];
    } catch (error) {
        console.error('NewsAPI取得エラー:', error);
        return [];
    }
}

// ユーティリティ関数
function stripHTML(html) {
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    return tmp.textContent || tmp.innerText || '';
}

// 画像関連の関数群
async function getRelevantImage(title, description, category) {
    try {
        // 1. まずキーワードから画像を検索
        const keywords = extractImageKeywords(title + ' ' + (description || ''));
        if (keywords.length > 0) {
            const searchedImage = await searchImageByKeywords(keywords, category);
            if (searchedImage) return searchedImage;
        }
        
        // 2. カテゴリー別のフォールバック画像
        const fallbackImage = NEWS_API_CONFIG.imageSearch.fallbackImages[category];
        if (fallbackImage) return fallbackImage;
        
        // 3. 最終フォールバック
        return `https://images.unsplash.com/photo-1586339949916-3e9457bef6d3?w=400&h=250&fit=crop&q=80`;
        
    } catch (error) {
        console.error('画像取得エラー:', error);
        return `https://images.unsplash.com/photo-1586339949916-3e9457bef6d3?w=400&h=250&fit=crop&q=80`;
    }
}

// キーワードから関連画像を検索
async function searchImageByKeywords(keywords, category) {
    // Unsplash API を優先して使用
    if (NEWS_API_CONFIG.imageSearch.unsplashAccessKey) {
        const unsplashImage = await searchUnsplash(keywords.join(' '), category);
        if (unsplashImage) return unsplashImage;
    }
    
    // Pixabay API をフォールバック
    if (NEWS_API_CONFIG.imageSearch.pixabayApiKey) {
        const pixabayImage = await searchPixabay(keywords.join(' '), category);
        if (pixabayImage) return pixabayImage;
    }
    
    return null;
}

// Unsplash API 検索
async function searchUnsplash(query, category) {
    try {
        const response = await fetch(
            `https://api.unsplash.com/search/photos?query=${encodeURIComponent(query)}&per_page=1&orientation=landscape`,
            {
                headers: {
                    'Authorization': `Client-ID ${NEWS_API_CONFIG.imageSearch.unsplashAccessKey}`
                }
            }
        );
        
        if (response.ok) {
            const data = await response.json();
            if (data.results && data.results.length > 0) {
                const image = data.results[0];
                return `${image.urls.regular}&w=400&h=250&fit=crop`;
            }
        }
    } catch (error) {
        console.warn('Unsplash検索エラー:', error);
    }
    return null;
}

// Pixabay API 検索
async function searchPixabay(query, category) {
    try {
        const response = await fetch(
            `https://pixabay.com/api/?key=${NEWS_API_CONFIG.imageSearch.pixabayApiKey}&q=${encodeURIComponent(query)}&image_type=photo&per_page=3&min_width=400&min_height=250&category=${getPixabayCategory(category)}`
        );
        
        if (response.ok) {
            const data = await response.json();
            if (data.hits && data.hits.length > 0) {
                const image = data.hits[0];
                return image.webformatURL;
            }
        }
    } catch (error) {
        console.warn('Pixabay検索エラー:', error);
    }
    return null;
}

// 画像検索用キーワード抽出
function extractImageKeywords(text) {
    const keywords = [];
    
    // 日本語キーワードマッピング
    const keywordMap = {
        '観光': ['travel', 'tourism', 'sightseeing'],
        '温泉': ['hot spring', 'onsen', 'spa'],
        'グルメ': ['food', 'cuisine', 'restaurant'],
        '祭り': ['festival', 'matsuri', 'celebration'],
        'イベント': ['event', 'festival', 'gathering'],
        '文化': ['culture', 'traditional', 'art'],
        'ショッピング': ['shopping', 'store', 'retail'],
        '宿泊': ['hotel', 'accommodation', 'lodging'],
        '交通': ['transportation', 'train', 'travel'],
        '天気': ['weather', 'sky', 'nature'],
        '防災': ['disaster', 'emergency', 'safety'],
        '桜': ['cherry blossom', 'sakura', 'spring'],
        '紅葉': ['autumn leaves', 'fall foliage', 'maple'],
        '海': ['ocean', 'beach', 'sea'],
        '山': ['mountain', 'hiking', 'nature'],
        '公園': ['park', 'garden', 'green'],
        '美術館': ['museum', 'art gallery', 'culture'],
        'カフェ': ['cafe', 'coffee', 'dining'],
        'ホテル': ['hotel', 'accommodation', 'building']
    };
    
    // 日本語キーワードを英語に変換
    for (const [japanese, english] of Object.entries(keywordMap)) {
        if (text.includes(japanese)) {
            keywords.push(...english);
        }
    }
    
    // 既存の英語キーワードも抽出
    const englishKeywords = text.match(/[a-zA-Z]+/g);
    if (englishKeywords) {
        keywords.push(...englishKeywords.filter(word => word.length > 3));
    }
    
    return [...new Set(keywords)].slice(0, 3); // 重複を除去して最大3個
}

// Pixabayカテゴリーマッピング
function getPixabayCategory(newsCategory) {
    const categoryMap = {
        'tourism': 'travel',
        'breaking': 'business',
        'gourmet': 'food',
        'events': 'music',
        'culture': 'religion',
        'shopping': 'business',
        'accommodation': 'places',
        'transport': 'transportation',
        'weather': 'nature'
    };
    return categoryMap[newsCategory] || 'backgrounds';
}

function getRandomImage() {
    return `https://images.unsplash.com/photo-1586339949916-3e9457bef6d3?w=400&h=250&fit=crop&q=80&random=${Math.floor(Math.random() * 1000)}`;
}

function mapCategoryFromFeed(feedCategory) {
    const categoryMap = {
        'all': 'tourism',
        'breaking': 'breaking',
        'domestic': 'breaking'
    };
    return categoryMap[feedCategory] || 'tourism';
}

function extractTags(text) {
    // 簡単なキーワード抽出
    const keywords = ['観光', 'グルメ', 'イベント', '文化', '交通', '宿泊', '天気', '防災'];
    return keywords.filter(keyword => text.includes(keyword)).slice(0, 3);
}

async function processNewsData(newsArray) {
    // 重複除去、ソート、データクリーニング
    const uniqueNews = newsArray.filter((news, index, self) => 
        index === self.findIndex(n => n.title === news.title)
    );
    
    // 各記事の画像を動的に取得
    for (const news of uniqueNews) {
        await enhanceNewsImage(news);
    }
    
    return uniqueNews.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));
}

// ニュース記事の画像を強化する関数
async function enhanceNewsImage(news) {
    // すでに適切な画像がある場合は処理をスキップ
    if (news.image && !news.image.includes('unsplash.com') && !news.image.includes('picsum.photos')) {
        return news;
    }
    
    try {
        let extractedImage = null;
        
        // 1. originalUrlがある場合は記事から画像を抽出
        if (news.originalUrl && news.originalUrl !== '#' && news.originalUrl.startsWith('http')) {
            extractedImage = await extractImageFromURL(news.originalUrl);
        }
        
        // 2. 画像が取得できない場合は記事内容に基づいて適切な画像を選択
        if (!extractedImage) {
            extractedImage = getRelevantImageForContent(news);
        }
        
        if (extractedImage) {
            news.image = extractedImage;
            console.log(`画像を更新: ${news.title.substring(0, 50)}... -> ${extractedImage}`);
        }
        
    } catch (error) {
        console.warn(`画像取得失敗: ${news.title}`, error);
        // フォールバック画像を設定
        news.image = getRelevantImageForContent(news);
    }
    
    return news;
}

// 記事内容に基づいて関連画像を取得する関数
function getRelevantImageForContent(news) {
    const title = news.title.toLowerCase();
    const content = (news.content || news.excerpt || '').toLowerCase();
    const category = news.category || 'general';
    const region = news.region || 'all';
    
    // キーワードマッピング（記事内容に基づいた適切な画像を選択）
    const imageMap = {
        // 観光・旅行関連
        '観光|旅行|スポット|名所|見どころ': 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=250&fit=crop&q=80',
        '温泉|風呂|入浴': 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=250&fit=crop&q=80',
        '祭り|イベント|フェスティバル': 'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=400&h=250&fit=crop&q=80',
        '雪|スキー|雪まつり|冬': 'https://images.unsplash.com/photo-1548273887-52d4b599b3d8?w=400&h=250&fit=crop&q=80',
        '海|海岸|ビーチ|マリン': 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=250&fit=crop&q=80',
        '山|登山|ハイキング': 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=250&fit=crop&q=80',
        '城|寺|神社|歴史': 'https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=400&h=250&fit=crop&q=80',
        
        // グルメ関連
        'グルメ|料理|食べ物|レストラン|食事': 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=250&fit=crop&q=80',
        '海鮮|魚|カニ|エビ|ウニ|イクラ': 'https://images.unsplash.com/photo-1565299585323-38174d4d8394?w=400&h=250&fit=crop&q=80',
        '肉|ステーキ|焼肉|牛': 'https://images.unsplash.com/photo-1544025162-d76694265947?w=400&h=250&fit=crop&q=80',
        'ラーメン|そば|うどん|麺': 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=400&h=250&fit=crop&q=80',
        '和食|日本料理|寿司': 'https://images.unsplash.com/photo-1563612117-88703a3a25c7?w=400&h=250&fit=crop&q=80',
        'スイーツ|ケーキ|デザート': 'https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400&h=250&fit=crop&q=80',
        
        // 交通・アクセス
        '電車|駅|鉄道|JR': 'https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=400&h=250&fit=crop&q=80',
        'バス|路線バス': 'https://images.unsplash.com/photo-1570125909232-eb263c188f7e?w=400&h=250&fit=crop&q=80',
        '飛行機|空港|航空': 'https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=400&h=250&fit=crop&q=80',
        '道路|高速道路|工事': 'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=400&h=250&fit=crop&q=80',
        
        // 宿泊
        'ホテル|旅館|宿泊|泊まる': 'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400&h=250&fit=crop&q=80',
        
        // 天気・防災
        '天気|気象|雨|台風|雪': 'https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=400&h=250&fit=crop&q=80',
        '地震|防災|災害|避難': 'https://images.unsplash.com/photo-1581833971358-2c8b550f87b3?w=400&h=250&fit=crop&q=80',
        
        // 地域別
        '東京|スカイツリー|浅草|渋谷': 'https://images.unsplash.com/photo-1513407030348-c983a97b98d8?w=400&h=250&fit=crop&q=80',
        '北海道|札幌|函館|知床': 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=250&fit=crop&q=80',
        '大阪|京都|奈良|関西': 'https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=400&h=250&fit=crop&q=80',
        
        // その他・文化
        '文化|芸術|美術館|博物館': 'https://images.unsplash.com/photo-1541961017774-22349e4a1262?w=400&h=250&fit=crop&q=80',
        'ショッピング|買い物|商店街': 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=250&fit=crop&q=80'
    };
    
    // タイトルと内容を結合してチェック
    const searchText = `${title} ${content}`;
    
    // キーワードマッチング
    for (const [keywords, imageUrl] of Object.entries(imageMap)) {
        const keywordRegex = new RegExp(keywords, 'i');
        if (keywordRegex.test(searchText)) {
            return imageUrl;
        }
    }
    
    // カテゴリー別のデフォルト画像
    const categoryImages = {
        tourism: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=250&fit=crop&q=80',
        gourmet: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=250&fit=crop&q=80',
        events: 'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=400&h=250&fit=crop&q=80',
        culture: 'https://images.unsplash.com/photo-1541961017774-22349e4a1262?w=400&h=250&fit=crop&q=80',
        shopping: 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=250&fit=crop&q=80',
        accommodation: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400&h=250&fit=crop&q=80',
        transport: 'https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=400&h=250&fit=crop&q=80',
        weather: 'https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=400&h=250&fit=crop&q=80',
        breaking: 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=250&fit=crop&q=80'
    };
    
    return categoryImages[category] || 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=250&fit=crop&q=80';
}

// サンプルデータの画像を動的に更新
async function enhanceSampleDataImages() {
    for (const news of newsData) {
        await enhanceNewsImage(news);
    }
}

// 初期化
document.addEventListener('DOMContentLoaded', async function() {
    initializeEventListeners();
    initializeLazyLoading();
    
    loadNews();
    updateDateTime();
    setInterval(updateDateTime, 60000); // 1分ごとに時刻更新
    
    // 初期地域表示を設定
    updateRegionDisplay('all');
    
    // もっと見るボタンのイベントリスナー
    const loadMoreBtn = document.getElementById('loadMoreBtn');
    if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', () => {
            loadMoreNews(false);
        });
    }
});

// 画像遅延読み込みの初期化
function initializeLazyLoading() {
    if ('IntersectionObserver' in window) {
        imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    const src = img.dataset.src;
                    if (src) {
                        loadImage(img, src);
                        observer.unobserve(img);
                    }
                }
            });
        }, {
            rootMargin: '50px'
        });
    }
}

// 画像読み込み関数
function loadImage(img, src) {
    // キャッシュをチェック
    if (imageCache.has(src)) {
        img.src = src;
        img.classList.remove('loading');
        return;
    }
    
    // 新しい画像を読み込み
    const tempImage = new Image();
    tempImage.onload = () => {
        imageCache.set(src, true);
        img.src = src;
        img.classList.remove('loading');
        img.classList.add('loaded');
    };
    
    tempImage.onerror = () => {
        // エラー時はフォールバック画像を設定
        const fallbackSrc = 'https://images.unsplash.com/photo-1586339949916-3e9457bef6d3?w=400&h=250&fit=crop&q=80';
        img.src = fallbackSrc;
        img.classList.remove('loading');
        img.classList.add('error');
    };
    
    tempImage.src = src;
}

// イベントリスナーの初期化
function initializeEventListeners() {
    // 検索機能
    searchInput.addEventListener('input', debounce(handleSearch, 300));
    
    // 地域選択
    regionSelect.addEventListener('change', handleRegionChange);
    
    // カテゴリータブ
    categoryTabs.addEventListener('click', handleCategoryClick);
    
    // ニュースカードのクリックイベント（イベント委譲）
    document.addEventListener('click', handleNewsCardClick);
    
    // モーダル関連
    document.getElementById('modalClose').addEventListener('click', closeModal);
    newsModal.addEventListener('click', function(e) {
        if (e.target === newsModal) {
            closeModal();
        }
    });
    
    // ESCキーでモーダルを閉じる
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeModal();
        }
    });
}

// ニュースカードクリックハンドラー
function handleNewsCardClick(e) {
    // クリックされた要素またはその親要素でニュースIDを持つものを探す
    let target = e.target;
    let newsId = null;
    
    // 最大5階層まで親要素を遡る
    for (let i = 0; i < 5 && target; i++) {
        if (target.dataset && target.dataset.newsId) {
            newsId = target.dataset.newsId;
            break;
        }
        target = target.parentElement;
    }
    
    if (newsId) {
        e.preventDefault();
        e.stopPropagation();
        console.log('Opening modal for news ID:', newsId, 'Type:', typeof newsId); // デバッグ用
        openModal(newsId);
    }
}

// 検索機能
function handleSearch(e) {
    currentFilters.search = e.target.value.toLowerCase();
    filterAndDisplayNews();
}

// 地域選択機能
function handleRegionChange(e) {
    currentFilters.region = e.target.value;
    updateRegionDisplay(e.target.value);
    filterAndDisplayNews();
}

// 地域表示の更新
function updateRegionDisplay(regionValue) {
    const regionDisplay = document.getElementById('regionDisplay');
    const regionNames = {
        'all': '全国版',
        'tokyo': '東京版',
        'osaka': '大阪版',
        'kyoto': '京都版',
        'kanagawa': '神奈川版',
        'saitama': '埼玉版',
        'chiba': '千葉版',
        'hokkaido': '北海道版'
    };
    
    regionDisplay.textContent = regionNames[regionValue] || '全国版';
}

// カテゴリー選択機能
function handleCategoryClick(e) {
    if (e.target.classList.contains('nav-tab')) {
        // アクティブタブの切り替え
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        e.target.classList.add('active');
        
        currentFilters.category = e.target.getAttribute('data-category');
        filterAndDisplayNews();
    }
}

// ニュースのフィルタリングと表示
async function filterAndDisplayNews() {
    try {
        showLoading();
        
        // キャッシュされたニュースデータを使用
        let allNews = newsCache.data.length > 0 ? newsCache.data : await fetchExternalNews();
        
        const filteredNews = allNews.filter(news => {
            // カテゴリーフィルター
            if (currentFilters.category !== 'all' && news.category !== currentFilters.category) {
                return false;
            }
            
            // 地域フィルター
            if (currentFilters.region !== 'all' && news.region !== currentFilters.region && news.region !== 'all') {
                return false;
            }
            
            // 検索フィルター
            if (currentFilters.search) {
                const searchLower = currentFilters.search;
                return (
                    news.title.toLowerCase().includes(searchLower) ||
                    news.excerpt.toLowerCase().includes(searchLower) ||
                    news.tags.some(tag => tag.toLowerCase().includes(searchLower))
                );
            }
            
            return true;
        });
        
        displayNews(filteredNews);
    } catch (error) {
        console.error('フィルタリングエラー:', error);
        showErrorMessage('ニュースのフィルタリングに失敗しました。');
    } finally {
        hideLoading();
    }
}

// ニュースの初期ロード
async function loadNews() {
    try {
        showLoading();
        const externalNews = await fetchExternalNews();
        displayNews(externalNews);
    } catch (error) {
        console.error('ニュース読み込みエラー:', error);
        // エラー時は空の状態を表示
        displayNews([]);
        showErrorMessage('実際のニュース記事の取得に失敗しました。しばらく後で再度お試しください。');
    } finally {
        hideLoading();
    }
}

// ニュースの表示
function displayNews(news) {
    // トップニュースは「すべて」カテゴリーでのみ表示
    if (currentFilters.category === 'all') {
        displayTopNews(news);
        showTopNewsSection();
    } else {
        hideTopNewsSection();
    }
    
    // 速報ニュースを表示
    displayBreakingNews(news.filter(item => item.isBreaking));
    
    // 通常のニュースグリッドを表示
    displayNewsGrid(news.filter(item => !item.isBreaking));
}

// トップニュース表示
function displayTopNews(news) {
    const topNewsContainer = document.getElementById('topNews');
    if (!topNewsContainer) return;
    
    const topNews = news.slice(0, 3);
    if (topNews.length === 0) return;
    
    // 全ての記事を統一されたカードデザインで表示
    const topNewsHtml = topNews.map((item, index) => `
        <div class="top-news-card" data-news-id="${item.id}">
            <div class="top-news-card-image">
                <img class="lazy-image loading" data-src="${item.image}" alt="${item.title}" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='250'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3C/svg%3E">
                <div class="news-category-badge">${getCategoryName(item.category)}</div>
                ${index === 0 ? '<div class="top-badge">TOP</div>' : ''}
            </div>
            <div class="top-news-card-content">
                <h3 class="top-news-card-title">${item.title}</h3>
                <p class="top-news-card-excerpt">${item.excerpt}</p>
                <div class="top-news-card-meta">
                    <span class="news-source">${item.source}</span>
                    <span>${formatDate(item.publishedAt)}</span>
                </div>
            </div>
        </div>
    `).join('');
    
    topNewsContainer.innerHTML = `
        <div class="top-news-uniform-grid">
            ${topNewsHtml}
        </div>
    `;
    
    // 遅延読み込み対応
    if (imageObserver) {
        topNewsContainer.querySelectorAll('.lazy-image').forEach(img => {
            imageObserver.observe(img);
        });
    } else {
        // Intersection Observer が使えない場合は即座に読み込み
        topNewsContainer.querySelectorAll('.lazy-image').forEach(img => {
            loadImage(img, img.dataset.src);
        });
    }
}

// 速報ニュース表示
function displayBreakingNews(breakingNews) {
    if (breakingNews.length === 0) {
        breakingNewsContainer.style.display = 'none';
        return;
    }
    
    breakingNewsContainer.style.display = 'block';
    const breakingHtml = breakingNews.map(item => `
        <div class="breaking-item" data-news-id="${item.id}">
            <span class="breaking-badge">速報</span>
            <span>${item.title}</span>
        </div>
    `).join('');
    
    breakingNewsContainer.innerHTML = breakingHtml;
}

// ニュースグリッド表示
function displayNewsGrid(news) {
    const gridHtml = news.map(item => `
        <div class="news-card" data-news-id="${item.id}">
            <div class="news-card-content">
                <div class="news-card-text">
                    <h3 class="news-card-title">${item.title}</h3>
                    <p class="news-card-excerpt">${item.excerpt}</p>
                    <div class="news-card-meta">
                        <span class="news-source">${item.source}</span>
                        <span>${formatDate(item.publishedAt)}</span>
                    </div>
                </div>
                <div class="news-card-image">
                    <img class="lazy-image loading" data-src="${item.image}" alt="${item.title}" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='80'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3C/svg%3E">
                </div>
            </div>
        </div>
    `).join('');
    
    newsGridContainer.innerHTML = gridHtml || '<p style="text-align: center; color: #6c757d; padding: 40px;">該当するニュースが見つかりませんでした。</p>';
    
    // 遅延読み込み対応
    if (gridHtml && imageObserver) {
        newsGridContainer.querySelectorAll('.lazy-image').forEach(img => {
            imageObserver.observe(img);
        });
    } else if (gridHtml) {
        // Intersection Observer が使えない場合は即座に読み込み
        newsGridContainer.querySelectorAll('.lazy-image').forEach(img => {
            loadImage(img, img.dataset.src);
        });
    }
}

// モーダル表示
async function openModal(newsId) {
    try {
        console.log('Attempting to open modal for ID:', newsId); // デバッグ用
        
        // キャッシュされたニュースから検索（型変換対応）
        let news = newsCache.data.find(item => item.id == newsId || item.id === newsId);
        
        // キャッシュになければデモデータから検索（型変換対応）
        if (!news) {
            news = newsData.find(item => item.id == newsId || item.id === newsId);
            console.log('Found in demo data:', !!news); // デバッグ用
        } else {
            console.log('Found in cache:', !!news); // デバッグ用
        }
        
        if (!news) {
            console.error('News not found for ID:', newsId);
            showErrorMessage('記事が見つかりませんでした。');
            return;
        }
        
        // モーダルの基本情報を設定
        const modalTitle = document.getElementById('modalTitle');
        const modalSource = document.getElementById('modalSource');
        const modalDate = document.getElementById('modalDate');
        const modalImage = document.getElementById('modalImage');
        const modalContent = document.getElementById('modalContent');
        const modalTags = document.getElementById('modalTags');
        
        if (modalTitle) modalTitle.textContent = news.title;
        if (modalSource) modalSource.textContent = news.source;
        if (modalDate) modalDate.textContent = formatDate(news.publishedAt);
        if (modalImage) modalImage.innerHTML = `<img src="${news.image}" alt="${news.title}">`;
        if (modalTags) modalTags.innerHTML = news.tags.map(tag => 
            `<span class="tag">${tag}</span>`
        ).join('');
        
        // 初期コンテンツを表示（ローディング表示）
        if (modalContent) {
            modalContent.innerHTML = `
                <div class="content-loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>記事を読み込み中...</p>
                </div>
            `;
        }
        
        // モーダルを先に表示
        newsModal.classList.add('show');
        document.body.style.overflow = 'hidden';
        console.log('Modal opened successfully'); // デバッグ用
        
        // 記事の全文を非同期で取得
        try {
            const fullContent = await fetchFullArticleContent(news);
            if (modalContent && newsModal.classList.contains('show')) {
                // モーダルがまだ開いている場合のみ更新
                modalContent.innerHTML = `<div class="article-content">${formatArticleContent(fullContent)}</div>`;
            }
        } catch (contentError) {
            console.warn('記事コンテンツ取得エラー:', contentError);
            if (modalContent && newsModal.classList.contains('show')) {
                modalContent.innerHTML = `<div class="article-content">${formatArticleContent(news.content || news.excerpt)}</div>`;
            }
        }
        
        // 外部リンクボタンを追加
        const modalFooter = document.querySelector('.modal-footer');
        if (modalFooter && news.originalUrl) {
            const existingLink = modalFooter.querySelector('.original-link');
            if (existingLink) existingLink.remove();
            
            const originalLinkBtn = document.createElement('button');
            originalLinkBtn.className = 'original-link';
            originalLinkBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> 元記事を見る';
            originalLinkBtn.onclick = () => window.open(news.originalUrl, '_blank');
            modalFooter.appendChild(originalLinkBtn);
        }
        
    } catch (error) {
        console.error('Error opening modal:', error);
        showErrorMessage('記事の表示中にエラーが発生しました。');
    }
}

// 記事コンテンツのフォーマット
function formatArticleContent(content) {
    if (!content) return '<p>記事の内容を取得できませんでした。</p>';
    
    // 段落に分割してHTMLとして整形
    return content
        .split('\n\n')
        .filter(paragraph => paragraph.trim().length > 0)
        .map(paragraph => `<p>${escapeHtml(paragraph.trim())}</p>`)
        .join('');
}

// HTMLエスケープ
function escapeHtml(text) {
    const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
}

// モーダル閉じる
function closeModal() {
    newsModal.classList.remove('show');
    document.body.style.overflow = '';
}

// ローディング表示
function showLoading() {
    loadingOverlay.classList.add('show');
}

function hideLoading() {
    loadingOverlay.classList.remove('show');
}

// エラーメッセージ表示
function showErrorMessage(message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.innerHTML = `
        <div class="error-content">
            <i class="fas fa-exclamation-triangle"></i>
            <span>${message}</span>
            <button class="error-close" onclick="this.parentElement.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `;
    
    document.body.appendChild(errorDiv);
    
    // 5秒後に自動で消す
    setTimeout(() => {
        if (errorDiv.parentElement) {
            errorDiv.remove();
        }
    }, 5000);
}

// 手動更新機能
function refreshNews() {
    newsCache.lastFetch = null; // キャッシュを無効化
    loadNews();
}

// ニュース更新状態を表示
function showUpdateStatus() {
    const statusDiv = document.createElement('div');
    statusDiv.className = 'update-status';
    statusDiv.innerHTML = `
        <div class="status-content">
            <i class="fas fa-sync fa-spin"></i>
            <span>最新ニュースを取得中...</span>
        </div>
    `;
    
    document.body.appendChild(statusDiv);
    
    return {
        remove: () => statusDiv.remove(),
        updateMessage: (message) => {
            statusDiv.querySelector('span').textContent = message;
            statusDiv.querySelector('i').classList.remove('fa-spin');
        }
    };
}

// ユーティリティ関数
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diff = now - date;
    
    // 1時間以内
    if (diff < 60 * 60 * 1000) {
        const minutes = Math.floor(diff / (60 * 1000));
        return `${minutes}分前`;
    }
    
    // 24時間以内
    if (diff < 24 * 60 * 60 * 1000) {
        const hours = Math.floor(diff / (60 * 60 * 1000));
        return `${hours}時間前`;
    }
    
    // それ以上
    return date.toLocaleDateString('ja-JP', {
        month: 'numeric',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

function getCategoryName(category) {
    const categories = {
        'all': 'すべて',
        'breaking': '速報',
        'local': '地域',
        'politics': '政治',
        'economy': '経済',
        'society': '社会',
        'culture': '文化',
        'sports': 'スポーツ',
        'weather': '天気'
    };
    return categories[category] || 'その他';
}

function updateDateTime() {
    const now = new Date();
    const timeString = now.toLocaleString('ja-JP', {
        year: 'numeric',
        month: 'numeric',
        day: 'numeric',
        weekday: 'short',
        hour: '2-digit',
        minute: '2-digit'
    });
    
    // ヘッダーに時刻表示を追加（実装によって調整）
    document.title = `Local News Hub - ${timeString}`;
}

// スムーススクロール
function smoothScrollTo(element) {
    element.scrollIntoView({
        behavior: 'smooth',
        block: 'start'
    });
}

// 無限スクロール（オプション機能）
let isLoading = false;
let page = 1;
let autoLoadCount = 0;
const MAX_AUTO_LOADS = 2;

window.addEventListener('scroll', () => {
    if (isLoading || autoLoadCount >= MAX_AUTO_LOADS) return;
    
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {
        loadMoreNews(true);
    }
});

function loadMoreNews(isAutoLoad = false) {
    if (isLoading) return;
    isLoading = true;
    
    showLoading();
    
    setTimeout(() => {
        // 実際の実装では追加のニュースデータを取得
        const additionalNews = generateMockNews(6);
        newsData.push(...additionalNews);
        
        filterAndDisplayNews();
        hideLoading();
        isLoading = false;
        page++;
        
        if (isAutoLoad) {
            autoLoadCount++;
            // 2回自動読み込み後は「もっと見る」ボタンを表示
            if (autoLoadCount >= MAX_AUTO_LOADS) {
                showLoadMoreButton();
            }
        }
    }, 1000);
}

// モックニュースデータ生成（デモ用）
function generateMockNews(count) {
    const mockTitles = [
        "新しい観光スポットがオープン",
        "地元グルメフェスティバル開催",
        "温泉地で特別宿泊プラン開始",
        "伝統工芸体験教室が人気",
        "観光バスの新ルート運行開始",
        "季節限定イベントが話題"
    ];
    
    const categories = ['tourism', 'gourmet', 'accommodation', 'culture', 'transport', 'events'];
    const regions = ['tokyo', 'osaka', 'kyoto', 'kanagawa'];
    
    return Array.from({ length: count }, (_, i) => ({
        id: newsData.length + i + 1,
        title: mockTitles[i % mockTitles.length],
        excerpt: "これは追加で読み込まれたニュースのサンプル記事です。実際の実装では外部APIからデータを取得します。",
        content: "これは追加コンテンツです。実際の実装では詳細な記事内容が含まれます。",
        image: `https://images.unsplash.com/photo-1586339949916-3e9457bef6d3?w=400&h=250&fit=crop&q=80&random=${newsData.length + i + 1}`,
        category: categories[i % categories.length],
        region: regions[i % regions.length],
        source: "観光情報センター",
        publishedAt: new Date(Date.now() - Math.random() * 24 * 60 * 60 * 1000).toISOString(),
        isBreaking: false,
        tags: ["観光", "地域情報"]
    }));
}

// もっと見るボタンの表示・非表示
function showLoadMoreButton() {
    const loadMoreContainer = document.getElementById('loadMoreContainer');
    if (loadMoreContainer) {
        loadMoreContainer.style.display = 'block';
    }
}

function hideLoadMoreButton() {
    const loadMoreContainer = document.getElementById('loadMoreContainer');
    if (loadMoreContainer) {
        loadMoreContainer.style.display = 'none';
    }
}

// トップニュースセクションの表示・非表示
function showTopNewsSection() {
    const topNewsSection = document.querySelector('.top-news-section');
    if (topNewsSection) {
        topNewsSection.style.display = 'block';
    }
}

function hideTopNewsSection() {
    const topNewsSection = document.querySelector('.top-news-section');
    if (topNewsSection) {
        topNewsSection.style.display = 'none';
    }
}