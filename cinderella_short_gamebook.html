<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinderella Adventure - English Gamebook</title>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXXX" 
            crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Hiragino Sans', 'ヒラギノ角ゴシック', 'Yu Gothic Medium', '游ゴシック Medium', YuGothic, '游ゴシック体', 'Meiryo', Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f8bbd9 100%);
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(227, 242, 253, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(248, 187, 217, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        .story-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 2px 8px rgba(255, 255, 255, 0.2) inset;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .story-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #e3f2fd, #f8bbd9, #e3f2fd, #f8bbd9, #e3f2fd);
            border-radius: 22px;
            z-index: -1;
            opacity: 0.1;
        }
        
        .choices {
            margin-top: 20px;
        }
        
        /* Audio controls styling */
        .audio-controls {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .audio-btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 0 8px;
            background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .audio-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(23, 162, 184, 0.4);
        }
        
        .audio-btn:active {
            transform: translateY(0);
        }
        
        .audio-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .audio-btn:hover::before {
            left: 100%;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            text-align: center;
            color: #34495e;
            font-size: 1.1em;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: justify;
        }
        
        .story-text p {
            margin-bottom: 15px;
        }
        
        .choice-button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            margin: 10px 0;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            position: relative;
            overflow: hidden;
            text-align: left;
            border: 2px solid transparent;
        }
        
        .choice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .choice-button:active {
            transform: translateY(0);
        }
        
        .choice-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .choice-button:hover::before {
            left: 100%;
        }
        
        .scene {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .scene:not(.hidden) {
            opacity: 1;
            transform: translateY(0);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hidden {
            display: none !important;
        }
        
        .choice-explanation {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            border: 2px solid #4CAF50;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .choice-explanation.wrong {
            background: linear-gradient(135deg, #fde8e8 0%, #ffebee 100%);
            border: 2px solid #dc3545;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.2);
        }
        
        .choice-explanation h3 {
            color: #2e7d32;
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .choice-explanation.wrong h3 {
            color: #c62828;
        }
        
        .choice-display {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }
        
        .choice-explanation.wrong .choice-display {
            border-left: 4px solid #dc3545;
        }
        
        .choice-display .english-text {
            font-size: 16px;
            font-weight: 600;
            color: #1565c0;
            margin-bottom: 8px;
        }
        
        .choice-display .japanese-text {
            font-size: 15px;
            color: #2e7d32;
            font-weight: 500;
        }
        
        .choice-explanation.wrong .choice-display .japanese-text {
            color: #c62828;
        }
        
        .explanation-text {
            font-size: 14px;
            color: #424242;
            line-height: 1.6;
            background: rgba(255, 255, 255, 0.6);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #81c784;
        }
        
        .choice-explanation.wrong .explanation-text {
            border-left: 3px solid #ef5350;
        }
        
        .negative-feedback {
            color: #d32f2f !important;
            font-weight: 600;
        }
        
        .old-choice-explanation {
            background-color: #fff3cd;
            border: 2px solid #ffeaa7;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            position: relative;
        }
        
        .choice-explanation::before {
            content: "💡";
            position: absolute;
            top: -10px;
            left: 20px;
            background-color: #fff3cd;
            padding: 0 10px;
            font-size: 1.2em;
        }
        
        .choice-explanation h4 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .choice-explanation p {
            color: #856404;
            line-height: 1.6;
            margin-bottom: 0;
        }
        
        .previous-question {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #e3f2fd;
        }
        
        .choice-display {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #f8bbd9;
        }
        
        .english-text {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .japanese-text {
            color: #6c757d;
            font-size: 0.9em;
            font-style: italic;
        }
        
        .explanation-text {
            background-color: rgba(245, 245, 245, 0.9);
            padding: 15px;
            border-radius: 8px;
            color: #495057;
            line-height: 1.6;
        }
        
        .positive-feedback {
            color: #28a745;
            font-weight: bold;
        }
        
        .restart-btn {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%) !important;
            box-shadow: 0 4px 15px rgba(253, 121, 168, 0.3) !important;
        }
        
        .restart-btn:hover {
            box-shadow: 0 6px 20px rgba(253, 121, 168, 0.4) !important;
        }
        
        .home-btn {
            background: linear-gradient(135deg, #6c5ce7 0%, #5f27cd 100%) !important;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3) !important;
        }
        
        .home-btn:hover {
            box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4) !important;
        }
        
        .nav-link {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }
        
        .nav-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e3f2fd 0%, #f8bbd9 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .scene-counter {
            text-align: center;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
            margin-bottom: 5px;
        }
        
        /* AdSense styling */
        .adsense-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .adsense-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .story-container {
                padding: 25px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .story-text {
                font-size: 1em;
            }
            
            .choice-button {
                padding: 12px 16px;
                font-size: 0.95em;
            }
        }
        
        @media (max-width: 480px) {
            .story-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.6em;
            }
        }
    </style>
</head>
<body>
    
    <!-- Navigation -->
    <div style="text-align: left; margin-bottom: 20px;">
        <a href="index.html" class="nav-link">← ルール説明に戻る</a>
    </div>
    
    <!-- AdSense 広告 (ヘッダー下) -->
    <div class="adsense-container">
        <div class="adsense-label">広告</div>
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-XXXXXXXXXXXXXXXXX"
             data-ad-slot="XXXXXXXXXX"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
    
    <!-- Progress Bar -->
    <div style="text-align: center; margin: 20px 0;">
        <div class="scene-counter" id="scene-progress" style="margin-bottom: 8px;">Scene 1 of 8</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 12.5%;"></div>
        </div>
    </div>
    
    <div class="story-container">
        <h1>シンデレラの冒険</h1>
        <p class="subtitle">～ガラスの靴と舞踏会の魔法～</p>
        
        <!-- Scene 1: Life with Stepfamily -->
        <div id="scene1" class="scene">
            <div class="story-text" data-scene="scene1">
                <p>Once upon a time, there was a kind girl named Cinderella.</p>
                <p>She lived with her stepmother and two stepsisters who were very mean to her.</p>
                <p>Every day, they made her do all the housework. What should Cinderella do?</p>
            </div>
            <div class="audio-controls">
                <button class="audio-btn" onclick="playSceneAudio('scene1')">🔊 英語音声を再生</button>
                <button class="audio-btn" onclick="stopAudio()">⏹️ 停止</button>
            </div>
            <div class="choices">
                <button class="choice-button" onclick="selectChoiceAndGoToScene('scene2', 'Work hard with a kind heart')">Work hard with a kind heart</button>
                <button class="choice-button" onclick="showWrongChoice('scene1', 'Complain and refuse to work')">Complain and refuse to work</button>
                <button class="choice-button" onclick="showWrongChoice('scene1', 'Be mean back to them')">Be mean back to them</button>
            </div>
        </div>

        <!-- Scene 2: The Royal Invitation -->
        <div id="scene2" class="scene">
            <!-- Choice explanation area (hidden by default) -->
            <div id="scene2-explanation" class="choice-explanation hidden">
                <h3>前の問題</h3>
                <div class="previous-question">
                    <div class="english-text" id="scene2-previous-question"></div>
                    <div class="japanese-text" id="scene2-previous-question-translation"></div>
                </div>
                
                <h3>あなたが選んだ選択肢</h3>
                <div class="choice-display">
                    <div class="english-text">
                        <span id="scene2-choice-text"></span>
                    </div>
                    <div class="japanese-text" id="scene2-choice-translation"></div>
                </div>
                <div class="explanation-text" id="scene2-choice-explanation"></div>
            </div>
            <div class="section-divider hidden" id="scene2-divider" style="height: 20px; border-bottom: 1px solid rgba(227, 242, 253, 0.2); margin: 20px 0;"></div>
            
            <div class="story-text" data-scene="scene2">
                <p><span class="positive-feedback">Good choice!</span> Cinderella always worked hard and stayed kind.</p>
                <p>One day, a messenger brought an invitation to a royal ball at the palace!</p>
                <p>All the young women in the kingdom were invited. What should Cinderella do?</p>
            </div>
            <div class="audio-controls">
                <button class="audio-btn" onclick="playSceneAudio('scene2')">🔊 英語音声を再生</button>
                <button class="audio-btn" onclick="stopAudio()">⏹️ 停止</button>
            </div>
            <div class="choices">
                <button class="choice-button" onclick="selectChoiceAndGoToScene('scene3', 'Ask politely if she can go')">Ask politely if she can go</button>
                <button class="choice-button" onclick="showWrongChoice('scene2', 'Demand to go to the ball')">Demand to go to the ball</button>
                <button class="choice-button" onclick="showWrongChoice('scene2', 'Hide the invitation')">Hide the invitation</button>
            </div>
        </div>

        <!-- Scene 3: Stepfamily's Refusal -->
        <div id="scene3" class="scene">
            <!-- Choice explanation area (hidden by default) -->
            <div id="scene3-explanation" class="choice-explanation hidden">
                <h3>前の問題</h3>
                <div class="previous-question">
                    <div class="english-text" id="scene3-previous-question"></div>
                    <div class="japanese-text" id="scene3-previous-question-translation"></div>
                </div>
                
                <h3>あなたが選んだ選択肢</h3>
                <div class="choice-display">
                    <div class="english-text">
                        <span id="scene3-choice-text"></span>
                    </div>
                    <div class="japanese-text" id="scene3-choice-translation"></div>
                </div>
                <div class="explanation-text" id="scene3-choice-explanation"></div>
            </div>
            <div class="section-divider hidden" id="scene3-divider" style="height: 20px; border-bottom: 1px solid rgba(227, 242, 253, 0.2); margin: 20px 0;"></div>
            
            <div class="story-text" data-scene="scene3">
                <p><span class="positive-feedback">Polite choice!</span> Cinderella asked nicely if she could go to the ball.</p>
                <p>But her stepmother said, "No! You have too much work to do!"</p>
                <p>The stepsisters laughed and left for the ball. How should Cinderella feel?</p>
            </div>
            <div class="audio-controls">
                <button class="audio-btn" onclick="playSceneAudio('scene3')">🔊 英語音声を再生</button>
                <button class="audio-btn" onclick="stopAudio()">⏹️ 停止</button>
            </div>
            <div class="choices">
                <button class="choice-button" onclick="selectChoiceAndGoToScene('scene4', 'Feel sad but stay hopeful')">Feel sad but stay hopeful</button>
                <button class="choice-button" onclick="showWrongChoice('scene3', 'Get angry and break things')">Get angry and break things</button>
                <button class="choice-button" onclick="showWrongChoice('scene3', 'Follow them secretly')">Follow them secretly</button>
            </div>
        </div>

        <!-- Scene 4: The Fairy Godmother Appears -->
        <div id="scene4" class="scene">
            <!-- Choice explanation area (hidden by default) -->
            <div id="scene4-explanation" class="choice-explanation hidden">
                <h3>前の問題</h3>
                <div class="previous-question">
                    <div class="english-text" id="scene4-previous-question"></div>
                    <div class="japanese-text" id="scene4-previous-question-translation"></div>
                </div>
                
                <h3>あなたが選んだ選択肢</h3>
                <div class="choice-display">
                    <div class="english-text">
                        <span id="scene4-choice-text"></span>
                    </div>
                    <div class="japanese-text" id="scene4-choice-translation"></div>
                </div>
                <div class="explanation-text" id="scene4-choice-explanation"></div>
            </div>
            <div class="section-divider hidden" id="scene4-divider" style="height: 20px; border-bottom: 1px solid rgba(227, 242, 253, 0.2); margin: 20px 0;"></div>
            
            <div class="story-text" data-scene="scene4">
                <p><span class="positive-feedback">Wise choice!</span> Cinderella stayed hopeful even when she was sad.</p>
                <p>Suddenly, a kind fairy godmother appeared with a magic wand!</p>
                <p>"I will help you go to the ball, my dear," she said. What should Cinderella do?</p>
            </div>
            <div class="audio-controls">
                <button class="audio-btn" onclick="playSceneAudio('scene4')">🔊 英語音声を再生</button>
                <button class="audio-btn" onclick="stopAudio()">⏹️ 停止</button>
            </div>
            <div class="choices">
                <button class="choice-button" onclick="selectChoiceAndGoToScene('scene5', 'Thank the fairy godmother gratefully')">Thank the fairy godmother gratefully</button>
                <button class="choice-button" onclick="showWrongChoice('scene4', 'Ask for many expensive gifts')">Ask for many expensive gifts</button>
                <button class="choice-button" onclick="showWrongChoice('scene4', 'Run away in fear')">Run away in fear</button>
            </div>
        </div>

        <!-- Scene 5: The Magic Transformation -->
        <div id="scene5" class="scene">
            <!-- Choice explanation area (hidden by default) -->
            <div id="scene5-explanation" class="choice-explanation hidden">
                <h3>前の問題</h3>
                <div class="previous-question">
                    <div class="english-text" id="scene5-previous-question"></div>
                    <div class="japanese-text" id="scene5-previous-question-translation"></div>
                </div>
                
                <h3>あなたが選んだ選択肢</h3>
                <div class="choice-display">
                    <div class="english-text">
                        <span id="scene5-choice-text"></span>
                    </div>
                    <div class="japanese-text" id="scene5-choice-translation"></div>
                </div>
                <div class="explanation-text" id="scene5-choice-explanation"></div>
            </div>
            <div class="section-divider hidden" id="scene5-divider" style="height: 20px; border-bottom: 1px solid rgba(227, 242, 253, 0.2); margin: 20px 0;"></div>
            
            <div class="story-text" data-scene="scene5">
                <p><span class="positive-feedback">Grateful choice!</span> Cinderella thanked the fairy godmother with all her heart.</p>
                <p>With magic, the fairy gave her a beautiful dress and glass slippers!</p>
                <p>"But remember," warned the fairy, "the magic ends at midnight!" What should Cinderella remember?</p>
            </div>
            <div class="audio-controls">
                <button class="audio-btn" onclick="playSceneAudio('scene5')">🔊 英語音声を再生</button>
                <button class="audio-btn" onclick="stopAudio()">⏹️ 停止</button>
            </div>
            <div class="choices">
                <button class="choice-button" onclick="selectChoiceAndGoToScene('scene6', 'Promise to return before midnight')">Promise to return before midnight</button>
                <button class="choice-button" onclick="showWrongChoice('scene5', 'Ignore the warning')">Ignore the warning</button>
                <button class="choice-button" onclick="showWrongChoice('scene5', 'Ask to stay longer')">Ask to stay longer</button>
            </div>
        </div>

        <!-- Scene 6: At the Royal Ball -->
        <div id="scene6" class="scene">
            <!-- Choice explanation area (hidden by default) -->
            <div id="scene6-explanation" class="choice-explanation hidden">
                <h3>前の問題</h3>
                <div class="previous-question">
                    <div class="english-text" id="scene6-previous-question"></div>
                    <div class="japanese-text" id="scene6-previous-question-translation"></div>
                </div>
                
                <h3>あなたが選んだ選択肢</h3>
                <div class="choice-display">
                    <div class="english-text">
                        <span id="scene6-choice-text"></span>
                    </div>
                    <div class="japanese-text" id="scene6-choice-translation"></div>
                </div>
                <div class="explanation-text" id="scene6-choice-explanation"></div>
            </div>
            <div class="section-divider hidden" id="scene6-divider" style="height: 20px; border-bottom: 1px solid rgba(227, 242, 253, 0.2); margin: 20px 0;"></div>
            
            <div class="story-text" data-scene="scene6">
                <p><span class="positive-feedback">Responsible choice!</span> Cinderella promised to return before midnight.</p>
                <p>At the ball, the prince saw her and was amazed by her beauty and kindness.</p>
                <p>They danced together all evening. But then the clock began to strike twelve! What should Cinderella do?</p>
            </div>
            <div class="audio-controls">
                <button class="audio-btn" onclick="playSceneAudio('scene6')">🔊 英語音声を再生</button>
                <button class="audio-btn" onclick="stopAudio()">⏹️ 停止</button>
            </div>
            <div class="choices">
                <button class="choice-button" onclick="selectChoiceAndGoToScene('scene7', 'Keep her promise and leave immediately')">Keep her promise and leave immediately</button>
                <button class="choice-button" onclick="showWrongChoice('scene6', 'Stay and dance more')">Stay and dance more</button>
                <button class="choice-button" onclick="showWrongChoice('scene6', 'Tell the prince who she is')">Tell the prince who she is</button>
            </div>
        </div>

        <!-- Scene 7: The Glass Slipper -->
        <div id="scene7" class="scene">
            <!-- Choice explanation area (hidden by default) -->
            <div id="scene7-explanation" class="choice-explanation hidden">
                <h3>前の問題</h3>
                <div class="previous-question">
                    <div class="english-text" id="scene7-previous-question"></div>
                    <div class="japanese-text" id="scene7-previous-question-translation"></div>
                </div>
                
                <h3>あなたが選んだ選択肢</h3>
                <div class="choice-display">
                    <div class="english-text">
                        <span id="scene7-choice-text"></span>
                    </div>
                    <div class="japanese-text" id="scene7-choice-translation"></div>
                </div>
                <div class="explanation-text" id="scene7-choice-explanation"></div>
            </div>
            <div class="section-divider hidden" id="scene7-divider" style="height: 20px; border-bottom: 1px solid rgba(227, 242, 253, 0.2); margin: 20px 0;"></div>
            
            <div class="story-text" data-scene="scene7">
                <p><span class="positive-feedback">Honorable choice!</span> Cinderella kept her promise and ran from the palace.</p>
                <p>In her hurry, she lost one glass slipper on the palace steps!</p>
                <p>The prince found it and decided to find the girl whose foot fit the slipper. What should Cinderella do?</p>
            </div>
            <div class="audio-controls">
                <button class="audio-btn" onclick="playSceneAudio('scene7')">🔊 英語音声を再生</button>
                <button class="audio-btn" onclick="stopAudio()">⏹️ 停止</button>
            </div>
            <div class="choices">
                <button class="choice-button" onclick="selectChoiceAndGoToScene('scene8', 'Wait patiently and hope')">Wait patiently and hope</button>
                <button class="choice-button" onclick="showWrongChoice('scene7', 'Try to get the slipper back secretly')">Try to get the slipper back secretly</button>
                <button class="choice-button" onclick="showWrongChoice('scene7', 'Tell everyone she was at the ball')">Tell everyone she was at the ball</button>
            </div>
        </div>

        <!-- Wrong message scene -->
        <div id="wrong-message" class="scene hidden">
            <!-- Choice explanation area for wrong choices -->
            <div id="wrong-message-explanation" class="choice-explanation wrong hidden">
                <h3>あなたが選んだ選択肢</h3>
                <div class="choice-display">
                    <div class="english-text">
                        <span id="wrong-message-choice-text"></span>
                    </div>
                    <div class="japanese-text" id="wrong-message-choice-translation"></div>
                </div>
                <div class="explanation-text" id="wrong-message-choice-explanation"></div>
            </div>
            <div class="section-divider hidden" id="wrong-message-divider" style="height: 20px; border-bottom: 1px solid rgba(220, 53, 69, 0.2); margin: 20px 0;"></div>
            
            <div class="story-text" data-scene="wrong-message">
                <p>🚫 <span class="negative-feedback">Oops!</span> That choice doesn't match the real Cinderella story.</p>
                <p>In the traditional story, Cinderella is kind, patient, and forgiving.</p>
                <p>Try again and choose the answer that shows kindness and wisdom!</p>
            </div>
            <div class="choices">
                <button class="choice-button" onclick="goBack()">Try Again</button>
                <button class="choice-button restart-btn" onclick="restartGame()">Start Over</button>
                <button class="choice-button home-btn" onclick="location.href='index.html'">← Home</button>
            </div>
        </div>

        <!-- Scene 8: The Perfect Fit -->
        <div id="scene8" class="scene">
            <!-- Choice explanation area (hidden by default) -->
            <div id="scene8-explanation" class="choice-explanation hidden">
                <h3>前の問題</h3>
                <div class="previous-question">
                    <div class="english-text" id="scene8-previous-question"></div>
                    <div class="japanese-text" id="scene8-previous-question-translation"></div>
                </div>
                
                <h3>あなたが選んだ選択肢</h3>
                <div class="choice-display">
                    <div class="english-text">
                        <span id="scene8-choice-text"></span>
                    </div>
                    <div class="japanese-text" id="scene8-choice-translation"></div>
                </div>
                <div class="explanation-text" id="scene8-choice-explanation"></div>
            </div>
            <div class="section-divider hidden" id="scene8-divider" style="height: 20px; border-bottom: 1px solid rgba(227, 242, 253, 0.2); margin: 20px 0;"></div>
            
            <div class="story-text" data-scene="scene8">
                <p><span class="positive-feedback">Patient choice!</span> Cinderella waited hopefully.</p>
                <p>When the prince came to her house, the stepsisters tried the slipper, but it didn't fit!</p>
                <p>Then Cinderella tried it on, and it fit perfectly! What should happen next?</p>
            </div>
            <div class="audio-controls">
                <button class="audio-btn" onclick="playSceneAudio('scene8')">🔊 英語音声を再生</button>
                <button class="audio-btn" onclick="stopAudio()">⏹️ 停止</button>
            </div>
            <div class="choices">
                <button class="choice-button" onclick="selectChoiceAndGoToScene('ending-good', 'The prince recognizes her and they live happily ever after')">The prince recognizes her and they live happily ever after</button>
                <button class="choice-button" onclick="showWrongChoice('scene8', 'Cinderella pretends it was just luck')">Cinderella pretends it was just luck</button>
                <button class="choice-button" onclick="showWrongChoice('scene8', 'The stepfamily tries to stop them')">The stepfamily tries to stop them</button>
            </div>
        </div>

        <!-- Good Ending -->
        <div id="ending-good" class="scene">
            <div class="story-text">
                <h2 style="color: #28a745; text-align: center;">🎉 おめでとうございます！</h2>
                <p>The prince recognized Cinderella as the beautiful girl from the ball!</p>
                <p>They were married and lived happily ever after in the palace.</p>
                <p>Cinderella's kindness and good heart were rewarded, and she forgave her stepfamily.</p>
                <p><strong>You completed Cinderella's adventure with the perfect ending!</strong></p>
            </div>
            <div style="padding: 20px 0;">
                
            </div>
            <div class="choices">
                <button class="choice-button restart-btn" onclick="restartGame()">Play Again</button>
                <button class="choice-button home-btn" onclick="location.href='index.html'">← ルール説明に戻る</button>
            </div>
        </div>

        <div id="wrong-message" class="scene hidden">
            <!-- Choice explanation area for wrong choices -->
            <div id="choice-explanation" class="choice-explanation hidden">
                <h4>なぜこの選択肢が間違いなのでしょうか？</h4>
                <p id="explanation-text">
                    シンデレラの物語では、優しさ、忍耐、そして約束を守ることが重要なテーマです。困難な状況でも希望を失わず、他人に親切であり続けるシンデレラの性格を表す選択肢を選んでください。
                </p>
                <p>伝統的なシンデレラの物語に合った、優しさと誠実さを示す選択肢を選んでください。</p>
                <p>Try again and choose the answer that shows kindness and honesty!</p>
            </div>
            <div class="choices">
                <button class="choice-button" onclick="goBack()">Try Again</button>
                <button class="choice-button restart-btn" onclick="restartGame()">Start Over</button>
                <button class="choice-button home-btn" onclick="location.href='index.html'">← ルール説明に戻る</button>
            </div>
        </div>
    </div>

    <script>
        let currentScene = 'scene1';
        let previousScene = '';
        let currentSceneNumber = 1;
        const totalScenes = 8;
        let currentAudio = null;
        let selectedChoiceInfo = { text: '', translation: '', explanation: '' };
        let previousQuestionInfo = { text: '', translation: '' };

        // Scene audio content
        const sceneAudioContent = {
            'scene1': "Once upon a time, there was a kind girl named Cinderella. She lived with her stepmother and two stepsisters who were very mean to her. Every day, they made her do all the housework.",
            'scene2': "Cinderella always worked hard and stayed kind. One day, a messenger brought an invitation to a royal ball at the palace! All the young women in the kingdom were invited.",
            'scene3': "Cinderella asked nicely if she could go to the ball. But her stepmother said, No! You have too much work to do! The stepsisters laughed and left for the ball.",
            'scene4': "Cinderella stayed hopeful even when she was sad. Suddenly, a kind fairy godmother appeared with a magic wand! I will help you go to the ball, my dear, she said.",
            'scene5': "Cinderella thanked the fairy godmother with all her heart. With magic, the fairy gave her a beautiful dress and glass slippers! But remember, warned the fairy, the magic ends at midnight!",
            'scene6': "Cinderella promised to return before midnight. At the ball, the prince saw her and was amazed by her beauty and kindness. They danced together all evening. But then the clock began to strike twelve!",
            'scene7': "Cinderella kept her promise and ran from the palace. In her hurry, she lost one glass slipper on the palace steps! The prince found it and decided to find the girl whose foot fit the slipper.",
            'scene8': "Cinderella waited hopefully. When the prince came to her house, the stepsisters tried the slipper, but it didn't fit! Then Cinderella tried it on, and it fit perfectly!"
        };

        // Translation dictionary for questions
        const questionTranslations = {
            "Every day, they made her do all the housework. What should Cinderella do?": "毎日、シンデレラは家事をすべてやらされました。シンデレラはどうすべきでしょうか？",
            "All the young women in the kingdom were invited. What should Cinderella do?": "王国のすべての若い女性が招待されました。シンデレラはどうすべきでしょうか？",
            "The stepsisters laughed and left for the ball. How should Cinderella feel?": "義理の姉たちは笑って舞踏会に出かけました。シンデレラはどう感じるべきでしょうか？",
            "\"I will help you go to the ball, my dear,\" she said. What should Cinderella do?": "「あなたを舞踏会に行かせてあげましょう」と妖精が言いました。シンデレラはどうすべきでしょうか？",
            "\"But remember,\" warned the fairy, \"the magic ends at midnight!\" What should Cinderella remember?": "「でも忘れないで」と妖精が警告しました。「魔法は真夜中に終わります！」シンデレラは何を覚えておくべきでしょうか？",
            "They danced together all evening. But then the clock began to strike twelve! What should Cinderella do?": "二人は一晩中踊りました。しかし時計が12時を打ち始めました！シンデレラはどうすべきでしょうか？",
            "The prince found it and decided to find the girl whose foot fit the slipper. What should Cinderella do?": "王子はガラスの靴を見つけ、それが合う女性を探すことにしました。シンデレラはどうすべきでしょうか？",
            "Then Cinderella tried it on, and it fit perfectly! What should happen next?": "シンデレラが履いてみると、ぴったり合いました！次に何が起こるべきでしょうか？"
        };

        // Translation dictionary for Cinderella choices
        const choiceTranslations = {
            // Scene 1
            "She should try to understand her stepmother and build a good relationship": {
                translation: "継母を理解し、良い関係を築くよう努めるべき",
                explanation: "正解！困難な家族状況でも、相手を理解し良い関係を築こうとする姿勢は、シンデレラの優しさと賢さを示しています。"
            },
            "She should complain to her father about the unfair treatment": {
                translation: "不公平な扱いについて父に苦情を言うべき",
                explanation: "愚痴や苦情を言うのは簡単ですが、家族の調和を乱す可能性があります。シンデレラは忍耐強く建設的な解決策を選びます。"
            },
            "She should ignore the stepmother and avoid family interactions": {
                translation: "継母を無視して家族との関わりを避けるべき",
                explanation: "問題を避けても解決にはなりません。シンデレラは困難な状況でも優しさを失わず、積極的に関係改善を図ります。"
            },
            "Work hard with a kind heart": {
                translation: "優しい心で一生懸命働く",
                explanation: "正解！シンデレラは困難な状況でも優しさを失わない心の美しい人です。"
            },
            "Complain and refuse to work": {
                translation: "文句を言って働くことを拒否する",
                explanation: "シンデレラは忍耐強く、困難な状況でも前向きに取り組む人です。"
            },
            "Be mean back to them": {
                translation: "彼らに意地悪をし返す",
                explanation: "シンデレラは復讐をしない優しい心の持ち主です。"
            },
            
            // Scene 2
            "She should accept her new role but maintain her dignity and kindness": {
                translation: "新しい役割を受け入れつつも、尊厳と優しさを保つべき",
                explanation: "正解！つらい状況でも品位と優しさを保つシンデレラの強さが、後に幸福へと導かれる理由です。"
            },
            "She should run away from home to escape this treatment": {
                translation: "この扱いから逃れるために家出するべき",
                explanation: "逃げ出すのは危険です。シンデレラは困難な状況でも家族への愛と責任感を持ち続けます。"
            },
            "She should refuse to do the chores and demand equal treatment": {
                translation: "家事を拒否して平等な扱いを要求するべき",
                explanation: "反抗は状況を悪化させるかもしれません。シンデレラは忍耐と優しさで周りの人の心を動かします。"
            },
            "Ask politely if she can go": {
                translation: "行けるかどうか丁寧にお願いする",
                explanation: "正解！シンデレラは礼儀正しく、希望を諦めない強い心を持っています。"
            },
            "Demand to go to the ball": {
                translation: "舞踏会に行くことを要求する",
                explanation: "シンデレラは謙虚で礼儀正しい人です。要求するのは彼女らしくありません。"
            },
            "Hide the invitation": {
                translation: "招待状を隠す",
                explanation: "シンデレラは正直な人です。招待状を隠すような嘘はつきません。"
            },
            
            // Scene 3
            "Feel sad but stay hopeful": {
                translation: "悲しいが希望を失わない",
                explanation: "正解！シンデレラは困難な状況でも希望を失わない強い心を持っています。"
            },
            "Get angry and break things": {
                translation: "怒って物を壊す",
                explanation: "シンデレラは怒りで暴力的になることはありません。いつも冷静です。"
            },
            "Follow them secretly": {
                translation: "こっそり後をつける",
                explanation: "シンデレラは正直で誠実です。卑怯な行動はとりません。"
            },
            
            // Scene 4
            "Thank the fairy godmother gratefully": {
                translation: "妖精の名付け親に感謝する",
                explanation: "正解！シンデレラは感謝の心を忘れない素晴らしい人です。"
            },
            "Ask for many expensive gifts": {
                translation: "たくさんの高価な贈り物を求める",
                explanation: "シンデレラは欲深くありません。必要以上のものは求めません。"
            },
            "Run away in fear": {
                translation: "恐れて逃げる",
                explanation: "シンデレラは善良な心の持ち主で、親切な人を恐れることはありません。"
            },
            
            // Scene 5
            "Promise to return before midnight": {
                translation: "真夜中前に帰ると約束する",
                explanation: "正解！シンデレラは約束を守る誠実な人です。"
            },
            "Ignore the warning": {
                translation: "警告を無視する",
                explanation: "シンデレラは賢く、親切な人のアドバイスに耳を傾けます。"
            },
            "Ask to stay longer": {
                translation: "もっと長くいられるようにお願いする",
                explanation: "シンデレラは与えられたものに感謝し、更なる要求はしません。"
            },
            
            // Scene 6
            "Keep her promise and leave immediately": {
                translation: "約束を守ってすぐに帰る",
                explanation: "正解！シンデレラは約束を守る誠実で責任感のある人です。"
            },
            "Stay and dance more": {
                translation: "残ってもっと踊る",
                explanation: "シンデレラは約束を破ることはありません。誠実さが彼女の美徳です。"
            },
            "Tell the prince who she is": {
                translation: "王子に自分が誰かを教える",
                explanation: "シンデレラは謙虚で、自分の正体を明かすタイミングを知っています。"
            },
            
            // Scene 7
            "Wait patiently and hope": {
                translation: "辛抱強く待って希望を持つ",
                explanation: "正解！シンデレラは忍耐強く、運命を信じる心を持っています。"
            },
            "Try to get the slipper back secretly": {
                translation: "こっそりガラスの靴を取り戻そうとする",
                explanation: "シンデレラは正直で、卑怯な行動はとりません。"
            },
            "Tell everyone she was at the ball": {
                translation: "舞踏会にいたことをみんなに話す",
                explanation: "シンデレラは謙虚で、自慢話をするような人ではありません。"
            },
            
            // Scene 8
            "The prince recognizes her and they live happily ever after": {
                translation: "王子が彼女を認識し、幸せに暮らす",
                explanation: "正解！真の愛と善良な心が報われる美しい結末です。"
            },
            "Cinderella pretends it was just luck": {
                translation: "シンデレラは運だったふりをする",
                explanation: "シンデレラは正直な人です。真実を隠す必要はありません。"
            },
            "The stepfamily tries to stop them": {
                translation: "継家族が二人を止めようとする",
                explanation: "真実は必ず明らかになります。善が悪に勝つのが物語の教訓です。"
            }
        };

        // Shuffling functions
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function shuffleChoices(sceneId) {
            const scene = document.getElementById(sceneId);
            if (!scene) return;
            
            const choicesContainer = scene.querySelector('.choices');
            if (!choicesContainer) return;
            
            const choiceButtons = Array.from(choicesContainer.querySelectorAll('.choice-button'));
            if (choiceButtons.length > 1) {
                shuffleArray(choiceButtons);
                choiceButtons.forEach(button => {
                    choicesContainer.appendChild(button);
                });
            }
        }

        function initializeSceneChoices(sceneId) {
            shuffleChoices(sceneId);
        }
        
        // Function to display choice explanation in wrong message scene
        function displayChoiceExplanation(sceneId) {
            if (selectedChoiceInfo && selectedChoiceInfo.text) {
                // Update choice explanation elements
                const choiceTextElement = document.getElementById('wrong-message-choice-text');
                const translationElement = document.getElementById('wrong-message-choice-translation');
                const explanationElement = document.getElementById('wrong-message-choice-explanation');
                const explanationContainer = document.getElementById('wrong-message-explanation');
                const divider = document.getElementById('wrong-message-divider');
                
                if (choiceTextElement) choiceTextElement.textContent = selectedChoiceInfo.text;
                if (translationElement) translationElement.textContent = selectedChoiceInfo.translation;
                if (explanationElement) explanationElement.textContent = selectedChoiceInfo.explanation;
                
                // Show the explanation
                if (explanationContainer) explanationContainer.classList.remove('hidden');
                if (divider) divider.classList.remove('hidden');
            }
        }
        
        // Function to show wrong choice explanation
        function showWrongChoice(fromScene, selectedChoice = '') {
            previousScene = fromScene;
            
            // Look up translation and explanation from the dictionary
            const choiceData = choiceTranslations[selectedChoice];
            
            if (choiceData) {
                // Store the selected choice information
                selectedChoiceInfo = {
                    text: selectedChoice,
                    translation: choiceData.translation,
                    explanation: choiceData.explanation
                };
            } else {
                // Fallback if translation not found
                selectedChoiceInfo = {
                    text: selectedChoice,
                    translation: '翻訳が見つかりません',
                    explanation: 'この選択肢の説明が見つかりません。'
                };
            }
            
            goToScene('wrong-message');
            
            // Display the explanation
            displayChoiceExplanation('wrong-message');
        }
        
        // Go back function
        function goBack() {
            currentSceneNumber = parseInt(previousScene.replace('scene', ''));
            goToScene(previousScene);
        }
        
        // Restart game function
        function restartGame() {
            // Hide all scenes
            const scenes = document.querySelectorAll('.scene');
            scenes.forEach(scene => {
                scene.classList.add('hidden');
            });
            
            // Reset game state
            currentScene = 'scene1';
            previousScene = 'scene1';
            currentSceneNumber = 1;
            selectedChoiceInfo = { text: '', translation: '', explanation: '' };
            
            // Show first scene and shuffle choices
            document.getElementById('scene1').classList.remove('hidden');
            initializeSceneChoices('scene1');
            updateProgress();
        }

        function playSceneAudio(sceneId) {
            stopAudio();
            
            if (sceneAudioContent[sceneId]) {
                const utterance = new SpeechSynthesisUtterance(sceneAudioContent[sceneId]);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                
                currentAudio = utterance;
                speechSynthesis.speak(utterance);
            }
        }

        function stopAudio() {
            speechSynthesis.cancel();
            currentAudio = null;
        }

        function goToScene(sceneId) {
            // Hide all scenes first
            const allScenes = document.querySelectorAll('.scene');
            allScenes.forEach(scene => scene.classList.add('hidden'));
            
            // Handle wrong-message scene
            if (sceneId === 'wrong-message') {
                const wrongScene = document.getElementById('wrong-message');
                if (wrongScene) {
                    wrongScene.classList.remove('hidden');
                    wrongScene.classList.add('fade-in');
                }
                window.scrollTo(0, 0);
                return;
            }
            
            // Show new scene
            previousScene = currentScene;
            currentScene = sceneId;
            
            // Update scene number
            if (sceneId.startsWith('scene')) {
                currentSceneNumber = parseInt(sceneId.replace('scene', ''));
                updateProgress();
            }
            
            // Show new scene
            const newSceneElement = document.getElementById(sceneId);
            if (newSceneElement) {
                newSceneElement.classList.remove('hidden');
                
                // Initialize choice shuffling for this scene
                initializeSceneChoices(sceneId);
                
                // Smooth scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                console.error('Scene element not found: ' + sceneId);
            }
        }

        function updateProgress() {
            const progressPercentage = (currentSceneNumber / totalScenes) * 100;
            document.getElementById('progress-fill').style.width = progressPercentage + '%';
            document.getElementById('scene-progress').textContent = `Scene ${currentSceneNumber} of ${totalScenes}`;
        }

        function displayChoiceExplanation(sceneId) {
            // Safe implementation using pre-existing HTML elements
            const explanationDiv = document.getElementById(sceneId + '-explanation');
            const dividerDiv = document.getElementById(sceneId + '-divider');
            const choiceTextSpan = document.getElementById(sceneId + '-choice-text');
            const choiceTranslationDiv = document.getElementById(sceneId + '-choice-translation');
            const choiceExplanationDiv = document.getElementById(sceneId + '-choice-explanation');
            const previousQuestionDiv = document.getElementById(sceneId + '-previous-question');
            const previousQuestionTranslationDiv = document.getElementById(sceneId + '-previous-question-translation');
            
            if (explanationDiv && selectedChoiceInfo.text) {
                // Show explanation
                explanationDiv.classList.remove('hidden');
                if (dividerDiv) dividerDiv.classList.remove('hidden');
                
                // Fill in the content if elements exist
                if (choiceTextSpan) choiceTextSpan.textContent = selectedChoiceInfo.text;
                if (choiceTranslationDiv) choiceTranslationDiv.textContent = selectedChoiceInfo.translation;
                if (choiceExplanationDiv) choiceExplanationDiv.textContent = selectedChoiceInfo.explanation;
                if (previousQuestionDiv) previousQuestionDiv.textContent = previousQuestionInfo.text;
                if (previousQuestionTranslationDiv) previousQuestionTranslationDiv.textContent = previousQuestionInfo.translation;
            }
        }

        function selectChoiceAndGoToScene(nextSceneId, selectedChoice) {
            // Extract previous question from current scene
            const currentSceneElement = document.getElementById(currentScene);
            if (currentSceneElement) {
                const storyTextElement = currentSceneElement.querySelector('.story-text');
                if (storyTextElement) {
                    const paragraphs = storyTextElement.querySelectorAll('p');
                    if (paragraphs.length > 0) {
                        const lastParagraph = paragraphs[paragraphs.length - 1];
                        const questionText = lastParagraph.textContent.trim();
                        
                        // Store previous question info
                        previousQuestionInfo = {
                            text: questionText,
                            translation: questionTranslations[questionText] || 'この問題の翻訳が見つかりません'
                        };
                    }
                }
            }
            
            // Look up translation and explanation from the dictionary
            const choiceData = choiceTranslations[selectedChoice];
            
            if (choiceData) {
                // Store the selected choice information
                selectedChoiceInfo = {
                    text: selectedChoice,
                    translation: choiceData.translation,
                    explanation: choiceData.explanation
                };
            } else {
                // Fallback if translation not found
                selectedChoiceInfo = {
                    text: selectedChoice,
                    translation: '翻訳が見つかりません',
                    explanation: 'この選択肢の説明が見つかりません。'
                };
            }
            
            // Navigate to next scene
            goToScene(nextSceneId);
            
            // Display the explanation
            displayChoiceExplanation(nextSceneId);
        }

        function showWrongChoice(fromScene, selectedChoice = '') {            
            previousScene = fromScene;
            
            // Look up translation and explanation from the dictionary
            const choiceData = choiceTranslations[selectedChoice];
            
            if (choiceData) {
                // Store the selected choice information
                selectedChoiceInfo = {
                    text: selectedChoice,
                    translation: choiceData.translation,
                    explanation: choiceData.explanation
                };
            } else {
                // Fallback if translation not found
                selectedChoiceInfo = {
                    text: selectedChoice,
                    translation: '翻訳が見つかりません',
                    explanation: 'この選択肢の説明が見つかりません。'
                };
            }
            
            goToScene('wrong-message');
            
            // Display the explanation
            displayChoiceExplanation('wrong-message');
        }

        function goBack() {
            const wrongChoiceScene = sessionStorage.getItem('wrongChoiceScene') || previousScene;
            if (wrongChoiceScene) {
                currentSceneNumber = parseInt(wrongChoiceScene.replace('scene', ''));
                goToScene(wrongChoiceScene);
                document.getElementById('choice-explanation').classList.add('hidden');
            }
        }

        function restartGame() {
            // Hide all scenes
            const scenes = document.querySelectorAll('.scene');
            scenes.forEach(scene => {
                scene.classList.add('hidden');
                // Hide any visible explanations
                const explanation = scene.querySelector('.choice-explanation');
                const divider = scene.querySelector('.section-divider');
                if (explanation) explanation.classList.add('hidden');
                if (divider) divider.classList.add('hidden');
            });
            
            // Reset game state
            currentScene = 'scene1';
            previousScene = 'scene1';
            currentSceneNumber = 1;
            selectedChoiceInfo = { text: '', translation: '', explanation: '' };
            
            // Show first scene and update progress
            document.getElementById('scene1').classList.remove('hidden');
            updateProgress();
            
            // Shuffle choices for scene1
            initializeSceneChoices('scene1');
            
            // Stop audio and scroll to top
            stopAudio();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize progress and first scene on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Hide all scenes first
            const allScenes = document.querySelectorAll('.scene');
            allScenes.forEach(scene => scene.classList.add('hidden'));
            
            // Show scene1 explicitly
            const scene1 = document.getElementById('scene1');
            if (scene1) {
                scene1.classList.remove('hidden');
            }
            
            // Initialize progress
            updateProgress();
            
            // Initialize choice shuffling for scene1
            initializeSceneChoices('scene1');
        });
    </script>
</body>
</html>